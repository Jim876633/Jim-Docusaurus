<!doctype html><html lang=zh-Hant-TW dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-react/zustand-source-code" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>ã€Reactã€‘å¾ zustand åŸå§‹ç¢¼äº†è§£ç‹€æ…‹ç®¡ç† | Jim's notes</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://jimhuang.dev/react/zustand-source-code><meta data-rh=true property=og:locale content=zh_Hant-TW><meta data-rh=true name=docusaurus_locale content=zh-Hant-TW><meta data-rh=true name=docsearch:language content=zh-Hant-TW><meta data-rh=true name=google-site-verification content=Xow6fHBMZxltxfkcAm44dklblf6FUas98iNOJ1QhcKg><meta data-rh=true name="Jim's Blog" content="Jim docusaurus blog"><meta data-rh=true name=robots content=max-image-preview:large><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="ã€Reactã€‘å¾ zustand åŸå§‹ç¢¼äº†è§£ç‹€æ…‹ç®¡ç† | Jim's notes "><meta data-rh=true name=description content="Zustand çš„ä»‹ç´¹å¯ä»¥å…ˆçœ‹é€™ç¯‡ï¼Œé€™ä¸€ç¯‡ä¸»è¦æ˜¯é€éé–±è®€ zustand çš„åŸå§‹ç¢¼ä¾†äº†è§£å®ƒçš„é‹ä½œåŸç†ã€‚æœƒæƒ³è¦å¯«é€™ç¯‡æ˜¯å› ç‚ºä½¿ç”¨å¥—ä»¶å¤§å®¶éƒ½å·²ç¶“ç¿’ä»¥ç‚ºå¸¸ï¼Œä½†å¥—ä»¶åˆ°åº•å¹«æˆ‘å€‘åšäº†ä»€éº¼äº‹ç›¸ä¿¡å¤§éƒ¨åˆ†çš„äººï¼ˆåŒ…æ‹¬æˆ‘ï¼‰å¹³å¸¸æ˜¯ä¸æœƒç‰¹åˆ¥å»äº†è§£çš„ï¼Œæƒ³è¦çœ‹å¥—ä»¶çš„åŸå§‹ç¢¼ï¼Œå¾ˆå¤šåˆå¤ªè‰±æ¾€é›£ä»¥å’€åš¼ã€‚"><meta data-rh=true property=og:description content="Zustand çš„ä»‹ç´¹å¯ä»¥å…ˆçœ‹é€™ç¯‡ï¼Œé€™ä¸€ç¯‡ä¸»è¦æ˜¯é€éé–±è®€ zustand çš„åŸå§‹ç¢¼ä¾†äº†è§£å®ƒçš„é‹ä½œåŸç†ã€‚æœƒæƒ³è¦å¯«é€™ç¯‡æ˜¯å› ç‚ºä½¿ç”¨å¥—ä»¶å¤§å®¶éƒ½å·²ç¶“ç¿’ä»¥ç‚ºå¸¸ï¼Œä½†å¥—ä»¶åˆ°åº•å¹«æˆ‘å€‘åšäº†ä»€éº¼äº‹ç›¸ä¿¡å¤§éƒ¨åˆ†çš„äººï¼ˆåŒ…æ‹¬æˆ‘ï¼‰å¹³å¸¸æ˜¯ä¸æœƒç‰¹åˆ¥å»äº†è§£çš„ï¼Œæƒ³è¦çœ‹å¥—ä»¶çš„åŸå§‹ç¢¼ï¼Œå¾ˆå¤šåˆå¤ªè‰±æ¾€é›£ä»¥å’€åš¼ã€‚"><link data-rh=true rel=icon href=/img/favicon-32x32.png><link data-rh=true rel=canonical href=https://jimhuang.dev/react/zustand-source-code><link data-rh=true rel=alternate href=https://jimhuang.dev/react/zustand-source-code hreflang=zh-Hant-TW><link data-rh=true rel=alternate href=https://jimhuang.dev/react/zustand-source-code hreflang=x-default><link data-rh=true rel=preconnect href=https://SFNWCB64WA-dsn.algolia.net crossorigin=anonymous><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-PW7J7LMHR0"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-PW7J7LMHR0",{anonymize_ip:!0})</script><link rel=search type=application/opensearchdescription+xml title="Jim's notes " href=/opensearch.xml><link rel=stylesheet href=/assets/css/styles.7cefd60b.css><script src=/assets/js/runtime~main.16ca0f74.js defer></script><script src=/assets/js/main.fc232c33.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":(window.matchMedia("(prefers-color-scheme: light)").matches,"light"),document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label=è·³è‡³ä¸»è¦å†…å®¹><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>è·³è‡³ä¸»è¦å†…å®¹</a></div><nav aria-label=ä¸»å°èˆª class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class=navbar__inner><div class=navbar__items><button aria-label=åˆ‡æ›å°è¦½åˆ— aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/logo-small.png alt="Jim's logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/img/logo-darkmode-small.png alt="Jim's logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Jim's note</b></a><a class="navbar__item navbar__link" href=/interview/intro>ğŸ“š Frontend Q&A</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/tags>ğŸ“Œ Tag</a><a class="navbar__item navbar__link" href=/changelog>â³ Changelog</a><a href=https://github.com/Jim876633 target=_blank rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository" title=GitHub></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title=åˆ‡æ›æ·ºè‰²/æ·±è‰²æ¨¡å¼ï¼ˆç•¶å‰ç‚ºæ·ºè‰²æ¨¡å¼ï¼‰ aria-label=åˆ‡æ›æ·ºè‰²/æ·±è‰²æ¨¡å¼ï¼ˆç•¶å‰ç‚ºæ·ºè‰²æ¨¡å¼ï¼‰ aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_pyhR><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_wfgR><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="æœå°‹ (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>æœå°‹</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label=å›åˆ°é ‚éƒ¨ class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex=-1 class=sidebarLogo_isFc href=/><img src=/img/logo-small.png alt="Jim's logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/img/logo-darkmode-small.png alt="Jim's logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"><b>Jim's note</b></a><nav aria-label=æ–‡ä»¶å´é‚Šæ¬„ class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/>Intro</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/category/react>React</a><button aria-label="æ”¶èµ·å´é‚Šæ¬„åˆ†é¡ 'React'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/react/router>React router (v6)</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/react/zustand>Zustand</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/react/zustand-source-code>Zustand åŸå§‹ç¢¼è§£æ</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/category/typescript>TypeScript</a><button aria-label="å±•é–‹å´é‚Šæ¬„åˆ†é¡ 'TypeScript'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/category/docusaurus>Docusaurus</a><button aria-label="å±•é–‹å´é‚Šæ¬„åˆ†é¡ 'Docusaurus'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/category/css>CSS</a><button aria-label="å±•é–‹å´é‚Šæ¬„åˆ†é¡ 'CSS'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/category/mac>Mac</a><button aria-label="å±•é–‹å´é‚Šæ¬„åˆ†é¡ 'Mac'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/category/node>Node</a><button aria-label="å±•é–‹å´é‚Šæ¬„åˆ†é¡ 'Node'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/category/tips>Tips</a><button aria-label="å±•é–‹å´é‚Šæ¬„åˆ†é¡ 'Tips'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/category/vue>Vue</a><button aria-label="å±•é–‹å´é‚Šæ¬„åˆ†é¡ 'Vue'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/category/git>Git</a><button aria-label="å±•é–‹å´é‚Šæ¬„åˆ†é¡ 'Git'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/category/javascript>JavaScript</a><button aria-label="å±•é–‹å´é‚Šæ¬„åˆ†é¡ 'JavaScript'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/category/npm>Npm</a><button aria-label="å±•é–‹å´é‚Šæ¬„åˆ†é¡ 'Npm'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/category/unit-test>Unit Test</a><button aria-label="å±•é–‹å´é‚Šæ¬„åˆ†é¡ 'Unit Test'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/category/other>Other</a><button aria-label="å±•é–‹å´é‚Šæ¬„åˆ†é¡ 'Other'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/2023-ithome>2023 éµäººè³½</a><button aria-label="å±•é–‹å´é‚Šæ¬„åˆ†é¡ '2023 éµäººè³½'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/category/interview>Interview</a><button aria-label="å±•é–‹å´é‚Šæ¬„åˆ†é¡ 'Interview'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav><button type=button title=æ”¶èµ·å´é‚Šæ¬„ aria-label=æ”¶èµ·å´é‚Šæ¬„ class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width=20 height=20 aria-hidden=true class=collapseSidebarButtonIcon_kv0_><g fill=#7a7a7a><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"/><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"/></g></svg></button></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_z5aJ"><div class=docItemContainer_c0TR><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=é é¢è·¯å¾‘><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label=ä¸»é é¢ class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/category/react><span itemprop=name>React</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Zustand åŸå§‹ç¢¼è§£æ</span><meta itemprop=position content=2></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">æœ¬é å°è¦½</button></div><div class="theme-doc-markdown markdown"><header><h1>ã€Reactã€‘å¾ zustand åŸå§‹ç¢¼äº†è§£ç‹€æ…‹ç®¡ç†</h1></header><p>Zustand çš„ä»‹ç´¹å¯ä»¥å…ˆçœ‹<a href=/react/zustand>é€™ç¯‡</a>ï¼Œé€™ä¸€ç¯‡ä¸»è¦æ˜¯é€éé–±è®€ zustand çš„åŸå§‹ç¢¼ä¾†äº†è§£å®ƒçš„é‹ä½œåŸç†ã€‚æœƒæƒ³è¦å¯«é€™ç¯‡æ˜¯å› ç‚ºä½¿ç”¨å¥—ä»¶å¤§å®¶éƒ½å·²ç¶“ç¿’ä»¥ç‚ºå¸¸ï¼Œä½†å¥—ä»¶åˆ°åº•å¹«æˆ‘å€‘åšäº†ä»€éº¼äº‹ç›¸ä¿¡å¤§éƒ¨åˆ†çš„äººï¼ˆåŒ…æ‹¬æˆ‘ï¼‰å¹³å¸¸æ˜¯ä¸æœƒç‰¹åˆ¥å»äº†è§£çš„ï¼Œæƒ³è¦çœ‹å¥—ä»¶çš„åŸå§‹ç¢¼ï¼Œå¾ˆå¤šåˆå¤ªè‰±æ¾€é›£ä»¥å’€åš¼ã€‚</p>
<p>è€Œ zustnad å°±æ˜¯ä¸€å€‹å¾ˆå¥½å…¥é–€çš„å¥—ä»¶ï¼Œå®ƒçš„åŸå§‹ç¢¼ä¸å¤šï¼Œå¤§éƒ¨åˆ†éƒ½è »å®¹æ˜“çœ‹æ‡‚ï¼ˆæ’‡é™¤ Typescript çš„éƒ¨åˆ†ï¼‰ï¼Œçœ‹å®Œä¹Ÿæœƒè®“ä½ å°ç‹€æ…‹ç®¡ç†æœ‰æ›´æ·±çš„äº†è§£ï¼Œå¯ä»¥èªªæ˜¯åˆæ¬¡é–±è®€åŸå§‹ç¢¼çš„å¥½é¸æ“‡ï¼Œå°±è®“æˆ‘å€‘ä¾†å¥½å¥½äº†è§£ zustand æ˜¯å¦‚ä½•åšåˆ° React ç‹€æ…‹ç®¡ç†å§ï¼</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=åŸå§‹ç¢¼è§£æ>åŸå§‹ç¢¼è§£æ<a href=#åŸå§‹ç¢¼è§£æ class=hash-link aria-label=åŸå§‹ç¢¼è§£æçš„ç›´æ¥é€£çµ title=åŸå§‹ç¢¼è§£æçš„ç›´æ¥é€£çµ>â€‹</a></h2>
<p>zustand çš„æ ¸å¿ƒåŸå§‹ç¢¼ä¸»è¦æ˜¯åœ¨ <code>src</code> åº•ä¸‹çš„ <code>react.ts</code> ä»¥åŠ <code>vanilla.ts</code> é€™å…©æ”¯æª”æ¡ˆï¼Œé€™é‚Šä»¥ <a href=https://github.com/pmndrs/zustand/tree/v4.5.1/src target=_blank rel="noopener noreferrer">v4.5.1</a> çš„ç‰ˆæœ¬ç‚ºä¾‹ã€‚</p>
<img src=/assets/images/code-file-4a7bb04c29b0d8b5f6310c4bb01dd530.jpg style="width:min(100%,300px);display:block;margin:0 auto;border-radius:5px"><br><br>
<p>è€Œé€™å…©æ”¯æª”æ¡ˆç¸½å…±æœ‰ä¸‰å€‹ä¸»è¦çš„ function:</p>
<ol>
<li><code>create</code> (react.ts)ï¼šzustand çš„æ ¸å¿ƒ functionï¼Œç”¨ä¾†å»ºç«‹ storeã€‚</li>
<li><code>useStore</code> (react.ts)ï¼šè™•ç†åŒæ­¥ React å…§éƒ¨åŠå¤–éƒ¨çš„ state ç‹€æ…‹ã€‚</li>
<li><code>createStore</code> (vanilla.ts)ï¼šå»ºç«‹å…¨åŸŸçš„ state åŠå»ºç«‹è¨‚é–±æ¨¡å¼ã€‚</li>
</ol>
<p>ä»–å€‘ä¹‹é–“çš„é—œè¯æ€§æœƒåƒé€™æ¨£ï¼š</p>
<img src=/assets/images/code-structure-d528a79991b1c4b34239ba2e79af9536.jpg style=width:min(100%,100%);display:inline-block;margin:0;border-radius:5px><br><br>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=create-reactts>create (react.ts)<a href=#create-reactts class=hash-link aria-label="create (react.ts)çš„ç›´æ¥é€£çµ" title="create (react.ts)çš„ç›´æ¥é€£çµ">â€‹</a></h3>
<p>é¦–å…ˆä¾†çœ‹ä¸€ä¸‹ <a href=https://github.com/pmndrs/zustand/blob/6109bc3bd0f3850c2d9546956de971f27834ac7a/src/react.ts#L124 target=_blank rel="noopener noreferrer">create</a> çš„éƒ¨åˆ†ï¼š</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-background-color:#282c34;--prism-color:#ffffff><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=background-color:#282c34;color:#ffffff><code class=codeBlockLines_e6Vv><span class=token-line style=color:#ffffff><span class="token keyword" style=color:#c5a5c5>export</span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> create </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token operator" style=color:#d7deea>&lt;</span><span class="token constant" style=color:#5a9bcf>T</span><span class="token operator" style=color:#d7deea>></span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">createState</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> StateCreator</span><span class="token operator" style=color:#d7deea>&lt;</span><span class="token constant" style=color:#5a9bcf>T</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>[</span><span class="token punctuation" style=color:#8dc891>]</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>[</span><span class="token punctuation" style=color:#8dc891>]</span><span class="token operator" style=color:#d7deea>></span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>|</span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>undefined</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  createState </span><span class="token operator" style=color:#d7deea>?</span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>createImpl</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">createState</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> createImpl</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>as</span><span class="token plain"> Create</span><span class="token punctuation" style=color:#8dc891>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=è¤‡è£½ç¨‹å¼ç¢¼è‡³å‰ªè²¼ç°¿ title=è¤‡è£½ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>ä»–å›å‚³äº†ä¸€å€‹ <code>createImpl</code> çš„ functionï¼Œé€™å€‹ function å®šç¾©äº†ä¸€å€‹å« api çš„ç‰©ä»¶ï¼Œæ˜¯å‘¼å« <code>createStore</code> çš„å›å‚³å€¼ã€‚</p>
<p>ç„¶å¾Œå»ºç«‹ä¸€å€‹ <code>useBoundStore</code> çš„ functionï¼Œé€™å€‹ function æœƒå›å‚³ <code>useStore</code> ï¼Œä¸¦ä¸”æŠŠ api ç‰©ä»¶å‚³å…¥ <code>useStore</code>ã€‚</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-background-color:#282c34;--prism-color:#ffffff><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=background-color:#282c34;color:#ffffff><code class=codeBlockLines_e6Vv><span class=token-line style=color:#ffffff><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> createImpl </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>&lt;</span><span class="token constant" style=color:#5a9bcf>T</span><span class="token operator" style=color:#d7deea>></span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">createState</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> StateCreator</span><span class="token operator" style=color:#d7deea>&lt;</span><span class="token constant" style=color:#5a9bcf>T</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>[</span><span class="token punctuation" style=color:#8dc891>]</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>[</span><span class="token punctuation" style=color:#8dc891>]</span><span class="token operator" style=color:#d7deea>></span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token keyword" style=color:#c5a5c5>import</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token plain">meta</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token plain">env</span><span class="token operator" style=color:#d7deea>?.</span><span class="token constant" style=color:#5a9bcf>MODE</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>!==</span><span class="token plain"> </span><span class="token string" style=color:#8dc891>"production"</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>&&</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token keyword" style=color:#c5a5c5>typeof</span><span class="token plain"> createState </span><span class="token operator" style=color:#d7deea>!==</span><span class="token plain"> </span><span class="token string" style=color:#8dc891>"function"</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token builtin" style=color:#D8DEE9>console</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token function" style=color:#79b6f2>warn</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">      </span><span class="token string" style=color:#8dc891>"[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`."</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> api </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">    </span><span class="token keyword" style=color:#c5a5c5>typeof</span><span class="token plain"> createState </span><span class="token operator" style=color:#d7deea>===</span><span class="token plain"> </span><span class="token string" style=color:#8dc891>"function"</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>?</span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>createStore</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">createState</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> createState</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> useBoundStore</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> </span><span class="token function-variable function" style=color:#79b6f2>any</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">selector</span><span class="token operator" style=color:#d7deea>?</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> </span><span class="token builtin" style=color:#D8DEE9>any</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> equalityFn</span><span class="token operator" style=color:#d7deea>?</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> </span><span class="token builtin" style=color:#D8DEE9>any</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">    </span><span class="token function" style=color:#79b6f2>useStore</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">api</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> selector</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> equalityFn</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  Object</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token function" style=color:#79b6f2>assign</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">useBoundStore</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> api</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>return</span><span class="token plain"> useBoundStore</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain"></span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=è¤‡è£½ç¨‹å¼ç¢¼è‡³å‰ªè²¼ç°¿ title=è¤‡è£½ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=createstore-vanillats>createStore (vanilla.ts)<a href=#createstore-vanillats class=hash-link aria-label="createStore (vanilla.ts)çš„ç›´æ¥é€£çµ" title="createStore (vanilla.ts)çš„ç›´æ¥é€£çµ">â€‹</a></h3>
<p>æ¥è‘—ä¾†çœ‹ä¸€ä¸‹ <a href=https://github.com/pmndrs/zustand/blob/6109bc3bd0f3850c2d9546956de971f27834ac7a/src/vanilla.ts#L109 target=_blank rel="noopener noreferrer">createStore</a>ï¼š</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-background-color:#282c34;--prism-color:#ffffff><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=background-color:#282c34;color:#ffffff><code class=codeBlockLines_e6Vv><span class=token-line style=color:#ffffff><span class="token keyword" style=color:#c5a5c5>export</span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> createStore </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">createState</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  createState </span><span class="token operator" style=color:#d7deea>?</span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>createStoreImpl</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">createState</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> createStoreImpl</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>as</span><span class="token plain"> CreateStore</span><span class="token punctuation" style=color:#8dc891>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=è¤‡è£½ç¨‹å¼ç¢¼è‡³å‰ªè²¼ç°¿ title=è¤‡è£½ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>ä¸€æ¨£å›å‚³äº†ä¸€å€‹ <code>createStoreImpl</code> çš„ fucntionï¼š</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-background-color:#282c34;--prism-color:#ffffff><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=background-color:#282c34;color:#ffffff><code class=codeBlockLines_e6Vv><span class=token-line style=color:#ffffff><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> createStoreImpl</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> </span><span class="token function-variable function" style=color:#79b6f2>CreateStoreImpl</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">createState</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>type</span><span class="token plain"> </span><span class="token class-name" style=color:#FAC863>TState</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> ReturnType</span><span class="token operator" style=color:#d7deea>&lt;</span><span class="token keyword" style=color:#c5a5c5>typeof</span><span class="token plain"> createState</span><span class="token operator" style=color:#d7deea>></span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>type</span><span class="token plain"> </span><span class="token class-name" style=color:#FAC863>Listener</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">state</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> TState</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> prevState</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> TState</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>void</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>let</span><span class="token plain"> state</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> TState</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> listeners</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> Set</span><span class="token operator" style=color:#d7deea>&lt;</span><span class="token plain">Listener</span><span class="token operator" style=color:#d7deea>></span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>new</span><span class="token plain"> </span><span class="token class-name" style=color:#FAC863>Set</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> setState</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> StoreApi</span><span class="token operator" style=color:#d7deea>&lt;</span><span class="token plain">TState</span><span class="token operator" style=color:#d7deea>></span><span class="token punctuation" style=color:#8dc891>[</span><span class="token string" style=color:#8dc891>"setState"</span><span class="token punctuation" style=color:#8dc891>]</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">partial</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> replace</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token comment" style=color:#999999>// TODO: Remove type assertion once https://github.com/microsoft/TypeScript/issues/37663 is resolved</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token comment" style=color:#999999>// https://github.com/microsoft/TypeScript/issues/37663#issuecomment-759728342</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> nextState </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">      </span><span class="token keyword" style=color:#c5a5c5>typeof</span><span class="token plain"> partial </span><span class="token operator" style=color:#d7deea>===</span><span class="token plain"> </span><span class="token string" style=color:#8dc891>"function"</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">        </span><span class="token operator" style=color:#d7deea>?</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">partial </span><span class="token keyword" style=color:#c5a5c5>as</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">state</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> TState</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> TState</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">state</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">        </span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> partial</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token keyword" style=color:#c5a5c5>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token operator" style=color:#d7deea>!</span><span class="token plain">Object</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token keyword" style=color:#c5a5c5>is</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">nextState</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> state</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">      </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> previousState </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> state</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">      state </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">        replace </span><span class="token operator" style=color:#d7deea>??</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token keyword" style=color:#c5a5c5>typeof</span><span class="token plain"> nextState </span><span class="token operator" style=color:#d7deea>!==</span><span class="token plain"> </span><span class="token string" style=color:#8dc891>"object"</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>||</span><span class="token plain"> nextState </span><span class="token operator" style=color:#d7deea>===</span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>null</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">          </span><span class="token operator" style=color:#d7deea>?</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">nextState </span><span class="token keyword" style=color:#c5a5c5>as</span><span class="token plain"> TState</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">          </span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> Object</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token function" style=color:#79b6f2>assign</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>{</span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> state</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> nextState</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">      listeners</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token function" style=color:#79b6f2>forEach</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">listener</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>listener</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">state</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> previousState</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> getState</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> StoreApi</span><span class="token operator" style=color:#d7deea>&lt;</span><span class="token plain">TState</span><span class="token operator" style=color:#d7deea>></span><span class="token punctuation" style=color:#8dc891>[</span><span class="token string" style=color:#8dc891>"getState"</span><span class="token punctuation" style=color:#8dc891>]</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> state</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> getInitialState</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> StoreApi</span><span class="token operator" style=color:#d7deea>&lt;</span><span class="token plain">TState</span><span class="token operator" style=color:#d7deea>></span><span class="token punctuation" style=color:#8dc891>[</span><span class="token string" style=color:#8dc891>"getInitialState"</span><span class="token punctuation" style=color:#8dc891>]</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    initialState</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> subscribe</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> StoreApi</span><span class="token operator" style=color:#d7deea>&lt;</span><span class="token plain">TState</span><span class="token operator" style=color:#d7deea>></span><span class="token punctuation" style=color:#8dc891>[</span><span class="token string" style=color:#8dc891>"subscribe"</span><span class="token punctuation" style=color:#8dc891>]</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">listener</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">    listeners</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token function" style=color:#79b6f2>add</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">listener</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">    </span><span class="token comment" style=color:#999999>// Unsubscribe</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">    </span><span class="token keyword" style=color:#c5a5c5>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> listeners</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token function" style=color:#79b6f2>delete</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">listener</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">  </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> destroy</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> StoreApi</span><span class="token operator" style=color:#d7deea>&lt;</span><span class="token plain">TState</span><span class="token operator" style=color:#d7deea>></span><span class="token punctuation" style=color:#8dc891>[</span><span class="token string" style=color:#8dc891>"destroy"</span><span class="token punctuation" style=color:#8dc891>]</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token keyword" style=color:#c5a5c5>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token keyword" style=color:#c5a5c5>import</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token plain">meta</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token plain">env</span><span class="token operator" style=color:#d7deea>?.</span><span class="token constant" style=color:#5a9bcf>MODE</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>!==</span><span class="token plain"> </span><span class="token string" style=color:#8dc891>"production"</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">      </span><span class="token builtin" style=color:#D8DEE9>console</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token function" style=color:#79b6f2>warn</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">        </span><span class="token string" style=color:#8dc891>"[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">      </span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    listeners</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token function" style=color:#79b6f2>clear</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> api </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"> setState</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> getState</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> getInitialState</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> subscribe</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> destroy </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> initialState </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">state </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>createState</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">setState</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> getState</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> api</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>return</span><span class="token plain"> api </span><span class="token keyword" style=color:#c5a5c5>as</span><span class="token plain"> </span><span class="token builtin" style=color:#D8DEE9>any</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain"></span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=è¤‡è£½ç¨‹å¼ç¢¼è‡³å‰ªè²¼ç°¿ title=è¤‡è£½ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>é¦–å…ˆå¯ä»¥çœ‹åˆ°ä»–å®£å‘Šäº†ä¸€å€‹ <code>state</code> è®Šæ•¸ï¼Œé€™å€‹è®Šæ•¸æ˜¯ç”¨ä¾†å­˜æ”¾å…¨åŸŸçš„ state å€¼ï¼Œç„¶å¾Œå»ºç«‹äº†ä¸€å€‹ <code>listeners</code> çš„ Set ç‰©ä»¶ï¼Œç”¨ä¾†å­˜æ”¾è¨‚é–±çš„ functionã€‚</p>
<p>createStore çš„é‡é»åœ¨æ–¼ä»–å»ºç«‹äº†èˆ‡è¨‚é–±æ¨¡å¼ç›¸é—œçš„ functionï¼š</p>
<ul>
<li><code>setState</code>ï¼šç”¨ä¾†æ›´æ–° state çš„ functionã€‚</li>
<li><code>getState</code>ï¼šå–å¾—ç›®å‰çš„ stateã€‚</li>
<li><code>getInitialState</code>ï¼šå–å¾—åˆå§‹çš„ stateã€‚</li>
<li><code>subscribe</code>ï¼šè¨‚é–± state çš„è®ŠåŒ–ã€‚</li>
<li><code>destroy</code>ï¼šéŠ·æ¯€è¨‚é–±ã€‚</li>
</ul>
<p><code>getState</code> è·Ÿ <code>getInitialState</code> éƒ½è »å¥½ç†è§£çš„ï¼Œå°±æ˜¯å–å¾—ç›®å‰çš„ state è·Ÿåˆå§‹çš„ stateã€‚
<code>setState</code> æœ‰åšä¸€å±¤åˆ¤æ–·ï¼Œå¦‚æœæ–°çš„å€¼è·ŸèˆŠçš„å€¼ä¸åŒï¼ˆä½¿ç”¨ Object.is åˆ¤æ–·ï¼‰ï¼Œå°±æœƒå» forEach listeners è£¡é¢å„²å­˜çš„æ‰€æœ‰ functionï¼Œé€™äº› function æˆ‘ç¨±ä¹‹ç‚º<span class="highlight-yellow highlight" style=font-weight:normal>æ›´æ–°å‡½å¼</span>ï¼Œå¾Œé¢æœƒå†èªªæ˜æ›´æ–°å‡½å¼æ˜¯ä»€éº¼ã€‚
<code>subscribe</code> å°±æ˜¯æŠŠæ›´æ–°å‡½å¼åŠ å…¥ listeners è£¡é¢ï¼Œä¸¦ä¸”å›å‚³ä¸€å€‹ function ç”¨ä¾†å–æ¶ˆè¨‚é–±ã€‚</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=usestore-reactts>useStore (react.ts)<a href=#usestore-reactts class=hash-link aria-label="useStore (react.ts)çš„ç›´æ¥é€£çµ" title="useStore (react.ts)çš„ç›´æ¥é€£çµ">â€‹</a></h3>
<p>æœ€å¾Œä¸€å€‹ function æ˜¯ <a href=https://github.com/pmndrs/zustand/blob/6109bc3bd0f3850c2d9546956de971f27834ac7a/src/react.ts#L53 target=_blank rel="noopener noreferrer">useStore</a> å¯ä»¥èªªæ˜¯ zustand çš„æ ¸å¿ƒ functionï¼š</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-background-color:#282c34;--prism-color:#ffffff><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=background-color:#282c34;color:#ffffff><code class=codeBlockLines_e6Vv><span class=token-line style=color:#ffffff><span class="token keyword" style=color:#c5a5c5>export</span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>function</span><span class="token plain"> </span><span class="token generic-function function" style=color:#79b6f2>useStore</span><span class="token generic-function generic class-name operator" style=color:#d7deea>&lt;</span><span class="token generic-function generic class-name" style=color:#FAC863>TState</span><span class="token generic-function generic class-name punctuation" style=color:#8dc891>,</span><span class="token generic-function generic class-name" style=color:#FAC863> StateSlice</span><span class="token generic-function generic class-name operator" style=color:#d7deea>></span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  api</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> WithReact</span><span class="token operator" style=color:#d7deea>&lt;</span><span class="token plain">StoreApi</span><span class="token operator" style=color:#d7deea>&lt;</span><span class="token plain">TState</span><span class="token operator" style=color:#d7deea>>></span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token function-variable function" style=color:#79b6f2>selector</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">state</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> TState</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> StateSlice </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> identity </span><span class="token keyword" style=color:#c5a5c5>as</span><span class="token plain"> </span><span class="token builtin" style=color:#D8DEE9>any</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  equalityFn</span><span class="token operator" style=color:#d7deea>?</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">a</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> StateSlice</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> b</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> StateSlice</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token builtin" style=color:#D8DEE9>boolean</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain"></span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token keyword" style=color:#c5a5c5>import</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token plain">meta</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token plain">env</span><span class="token operator" style=color:#d7deea>?.</span><span class="token constant" style=color:#5a9bcf>MODE</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>!==</span><span class="token plain"> </span><span class="token string" style=color:#8dc891>"production"</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>&&</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    equalityFn </span><span class="token operator" style=color:#d7deea>&&</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token operator" style=color:#d7deea>!</span><span class="token plain">didWarnAboutEqualityFn</span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token builtin" style=color:#D8DEE9>console</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token function" style=color:#79b6f2>warn</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">      </span><span class="token string" style=color:#8dc891>"[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    didWarnAboutEqualityFn </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token boolean" style=color:#ff8b50>true</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> slice </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>useSyncExternalStoreWithSelector</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">    api</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token plain">subscribe</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">    api</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token plain">getState</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">    api</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token plain">getServerState </span><span class="token operator" style=color:#d7deea>||</span><span class="token plain"> api</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token plain">getInitialState</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">    selector</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">    equalityFn</span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">  </span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token function" style=color:#79b6f2>useDebugValue</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">slice</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>return</span><span class="token plain"> slice</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain"></span><span class="token punctuation" style=color:#8dc891>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=è¤‡è£½ç¨‹å¼ç¢¼è‡³å‰ªè²¼ç°¿ title=è¤‡è£½ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>ä»–æŠŠå‰›å‰›å»ºç«‹çš„ <code>getState</code> è·Ÿ <code>subscribe</code> å‚³å…¥ <code>useSyncExternalStoreWithSelector</code>ï¼Œä¸¦å›å‚³äº†å®ƒçš„çµæœã€‚</p>
<p>é‚£é€™å€‹ <code>useSyncExternalStoreWithSelector</code> åˆæ˜¯æ€éº¼è¾¦åˆ°çš„å‘¢ï¼Ÿé€™å°±è¦æåˆ° react 18 æ–°å¢çš„ hook <a href=https://ru.react.dev/reference/react/useSyncExternalStore target=_blank rel="noopener noreferrer">useSyncExternalStore</a>ã€‚</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=usesyncexternalstore>useSyncExternalStore<a href=#usesyncexternalstore class=hash-link aria-label=useSyncExternalStoreçš„ç›´æ¥é€£çµ title=useSyncExternalStoreçš„ç›´æ¥é€£çµ>â€‹</a></h3>
<p><code>useSyncExternalStore</code> æ˜¯ react 18 æ–°å¢çš„ hookï¼Œç”¨ä¾†åŒæ­¥ React å…§éƒ¨åŠå¤–éƒ¨çš„ state ç‹€æ…‹ã€‚é€™æ˜¯ä»€éº¼æ„æ€å‘¢ï¼Ÿæˆ‘å€‘éƒ½çŸ¥é“ React åœ¨æ›´æ–° UI ç•«é¢æ™‚ï¼Œæœƒé€é useState ä¾†æ›´æ–° stateï¼Œä¸¦é€²è¡Œ re-renderï¼Œä½†å¦‚æœæˆ‘ä»Šå¤©ä¸æƒ³ç”¨ useState æƒ³è¦éš¨ä¾¿å»ºç«‹ä¸€å€‹ç‰©ä»¶å„²å­˜ stateï¼Œé‚£æˆ‘è¦æ€éº¼å‘Šè¨´ React é€™å€‹ç‰©ä»¶åº•ä¸‹çš„å€¼æ”¹è®Šæ™‚ï¼Œå¹«æˆ‘é‡æ–°é€²è¡Œç•«é¢æ›´æ–°å‘¢ï¼Ÿé€™å°±æ˜¯ <code>useSyncExternalStore</code> çš„ä½œç”¨æ‹‰ï¼</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-background-color:#282c34;--prism-color:#ffffff><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=background-color:#282c34;color:#ffffff><code class=codeBlockLines_e6Vv><span class=token-line style=color:#ffffff><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> snapshot </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>useSyncExternalStore</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  subscribe</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  getSnapshot</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  getServerSnapshot</span><br></span><span class=token-line style=color:#ffffff><span class="token plain"></span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=è¤‡è£½ç¨‹å¼ç¢¼è‡³å‰ªè²¼ç°¿ title=è¤‡è£½ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>æœƒå‚³å…¥ä¸‰å€‹åƒæ•¸ï¼š</p>
<ul>
<li><code>subscribe</code>ï¼šè¨‚é–± state çš„è®ŠåŒ–ã€‚</li>
<li><code>getSnapshot</code>ï¼šå–å¾—ç•¶å‰æœ€æ–°çš„å€¼ã€‚</li>
<li><code>getServerSnapshot</code>ï¼šå–å¾— SSR çš„åˆå§‹ç‹€æ…‹ï¼ˆå¯é¸ï¼‰ã€‚</li>
</ul>
<p>è€Œå› ç‚ºé€™å€‹ hook æ˜¯ React 18 æ–°å¢çš„ï¼Œæ‰€ä»¥ç‚ºäº†è®“ä¹‹å‰çš„ç‰ˆæœ¬ä¹Ÿå¯ä»¥åšä½¿ç”¨ï¼Œæ‰€ä»¥æœ‰å¦å¤–æŠŠé€™å€‹ hook æ‹‰å‡ºä¸€å€‹ç¨ç«‹çš„ package <a href=https://www.npmjs.com/package/use-sync-external-store target=_blank rel="noopener noreferrer">use-sync-external-store</a>ï¼Œé€éé€™å€‹ package çš„åŸå§‹ç¢¼ï¼Œæˆ‘å€‘å¯ä»¥ä¸€çªºç©¶ç«Ÿé€™å€‹ hook å¤§æ¦‚æ˜¯æ€éº¼å¯¦ä½œçš„ã€‚</p>
<img src=/assets/images/use-sync-external-store-aae6c790b92b767f751ea0c7a3aff8c2.jpg style=width:min(100%,100%);display:inline-block;margin:0;border-radius:5px><br><br>
<p>åŸå§‹ç¢¼ä½ç½®æ˜¯åœ¨ react package åº•ä¸‹çš„ <a href=https://github.com/facebook/react/blob/main/packages/use-sync-external-store/src/useSyncExternalStoreShimClient.js target=_blank rel="noopener noreferrer">useSyncExternalStoreShimClient.js</a> è£¡é¢ï¼Œé€™é‚Šåªåˆ—å‡ºé‡é»ç¨‹å¼ç¢¼ï¼š</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-background-color:#282c34;--prism-color:#ffffff><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=background-color:#282c34;color:#ffffff><code class=codeBlockLines_e6Vv><span class=token-line style=color:#ffffff><span class="token keyword" style=color:#c5a5c5>export</span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>function</span><span class="token plain"> </span><span class="token generic-function function" style=color:#79b6f2>useSyncExternalStore</span><span class="token generic-function generic class-name operator" style=color:#d7deea>&lt;</span><span class="token generic-function generic class-name constant" style=color:#5a9bcf>T</span><span class="token generic-function generic class-name operator" style=color:#d7deea>></span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token function-variable function" style=color:#79b6f2>subscribe</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>void</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>void</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token function-variable function" style=color:#79b6f2>getSnapshot</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token constant" style=color:#5a9bcf>T</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  getServerSnapshot</span><span class="token operator" style=color:#d7deea>?</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token constant" style=color:#5a9bcf>T</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain"></span><span class="token punctuation" style=color:#8dc891>)</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> </span><span class="token constant" style=color:#5a9bcf>T</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> value </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>getSnapshot</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>[</span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain">inst</span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> forceUpdate</span><span class="token punctuation" style=color:#8dc891>]</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>useState</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain">inst</span><span class="token operator" style=color:#d7deea>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain">value</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> getSnapshot</span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token function" style=color:#79b6f2>useEffect</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token keyword" style=color:#c5a5c5>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token function" style=color:#79b6f2>checkIfSnapshotChanged</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">inst</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">      </span><span class="token function" style=color:#79b6f2>forceUpdate</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain">inst</span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">    </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> </span><span class="token function-variable function" style=color:#79b6f2>handleStoreChange</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">      </span><span class="token keyword" style=color:#c5a5c5>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token function" style=color:#79b6f2>checkIfSnapshotChanged</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">inst</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">        </span><span class="token function" style=color:#79b6f2>forceUpdate</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain">inst</span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">      </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">    </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token keyword" style=color:#c5a5c5>return</span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>subscribe</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">handleStoreChange</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>[</span><span class="token plain">subscribe</span><span class="token punctuation" style=color:#8dc891>]</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token function" style=color:#79b6f2>useDebugValue</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">value</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>return</span><span class="token plain"> value</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain"></span><span class="token punctuation" style=color:#8dc891>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=è¤‡è£½ç¨‹å¼ç¢¼è‡³å‰ªè²¼ç°¿ title=è¤‡è£½ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>å¯ä»¥çœ‹åˆ°å…¶å¯¦æ˜¯é€é useState åŠ useEffect ä¾†é”æˆçš„ï¼ŒuseState çš„éƒ¨åˆ†æ˜¯ç‚ºäº†è®“ React é‡æ–° renderï¼Œä»–å¯¦ä½œäº†ä¸€å€‹å¼·åˆ¶æ›´æ–°çš„æ–¹æ³•ï¼Œå› ç‚ºä»–æ¯æ¬¡ setState çš„æ™‚å€™éƒ½æ˜¯å‚³å…¥ä¸€å€‹æ–°çš„ç‰©ä»¶ï¼Œè€Œ React å…§éƒ¨åœ¨åˆ¤æ–·æ˜¯å¦è¦ re-render æ™‚ï¼Œå…©å€‹ç‰©ä»¶æœƒåˆ¤å®šç‚ºä¸åŒï¼Œæ‰€ä»¥å°±æœƒé‡æ–° renderã€‚</p>
<p>è€Œåœ¨ useEffect çš„éƒ¨åˆ†ï¼Œå®ƒå»ºç«‹äº†ä¸€å€‹ <code>handleStoreChange</code> çš„ functionï¼Œè£¡é¢æœƒå…ˆåˆ¤æ–·ç›®å‰çš„å€¼æ˜¯å¦æœ‰æ”¹è®Šï¼Œå¦‚æœæœ‰æ”¹è®Šå°±æœƒå‘¼å« <code>forceUpdate</code> ä¾†é€²è¡Œå¼·åˆ¶æ›´æ–°ï¼Œè€Œé€™å€‹ <code>handleStoreChange</code> ä¹Ÿå°±æ˜¯æˆ‘å€‘å‰é¢èªªçš„ <span class="highlight-yellow highlight" style=font-weight:normal>æ›´æ–°å‡½å¼</span>ï¼Œæœ€å¾Œé€é <code>subscribe</code> æŠŠé€™å€‹ function åŠ å…¥ listeners è£¡é¢ã€‚</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=zustand-å…§éƒ¨è¨‚é–±æµç¨‹åœ–>zustand å…§éƒ¨è¨‚é–±æµç¨‹åœ–<a href=#zustand-å…§éƒ¨è¨‚é–±æµç¨‹åœ– class=hash-link aria-label="zustand å…§éƒ¨è¨‚é–±æµç¨‹åœ–çš„ç›´æ¥é€£çµ" title="zustand å…§éƒ¨è¨‚é–±æµç¨‹åœ–çš„ç›´æ¥é€£çµ">â€‹</a></h3>
<p>ä¸‹é¢æ˜¯<span class="highlight-yellow highlight" style=font-weight:normal>æ›´æ–°å‡½å¼</span>è¢«åŠ é€² listeners çš„æµç¨‹ï¼š</p>
<img src=/assets/images/update-flow-967b6b62d20ac5e7a3302f0cebca6867.gif style="width:min(100%,700px);display:block;margin:0 auto;border-radius:5px"><br><br>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=zustand-æ›´æ–°-state-æµç¨‹åœ–>zustand æ›´æ–° state æµç¨‹åœ–<a href=#zustand-æ›´æ–°-state-æµç¨‹åœ– class=hash-link aria-label="zustand æ›´æ–° state æµç¨‹åœ–çš„ç›´æ¥é€£çµ" title="zustand æ›´æ–° state æµç¨‹åœ–çš„ç›´æ¥é€£çµ">â€‹</a></h3>
<p>æ¥ä¸‹ä¾†è®“æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹å¦‚æœä»Šå¤©æœ‰å¤šå€‹å…ƒä»¶ä½¿ç”¨äº†åŒä¸€å€‹ zustand çš„ state æ™‚ï¼Œæ˜¯å¦‚ä½•é€²è¡Œæ›´æ–°çš„ã€‚ç¾åœ¨æœ‰å…©å€‹å…ƒä»¶</p>
<img src=/assets/images/counter-two-component-1f91b996c01e9dff93c6bfcfb8a8cf22.gif style="width:min(100%,350px);display:block;margin:0 auto;border-radius:5px"><br><br>
<div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style=--prism-background-color:#282c34;--prism-color:#ffffff><div class=codeBlockTitle_Ktv7>Counter.js</div><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-jsx codeBlock_bY9V thin-scrollbar" style=background-color:#282c34;color:#ffffff><code class=codeBlockLines_e6Vv><span class=token-line style=color:#ffffff><span class="token keyword module" style=color:#c5a5c5>import</span><span class="token plain"> </span><span class="token imports punctuation" style=color:#8dc891>{</span><span class="token imports"> useCountStore </span><span class="token imports punctuation" style=color:#8dc891>}</span><span class="token plain"> </span><span class="token keyword module" style=color:#c5a5c5>from</span><span class="token plain"> </span><span class="token string" style=color:#8dc891>"./store"</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain"></span><span class="token keyword module" style=color:#c5a5c5>export</span><span class="token plain"> </span><span class="token keyword module" style=color:#c5a5c5>default</span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>function</span><span class="token plain"> </span><span class="token function maybe-class-name" style=color:#79b6f2>Counter</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"> count</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> increment</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> decrement </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>useCountStore</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword control-flow" style=color:#c5a5c5>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token tag punctuation" style=color:#8dc891>&lt;</span><span class="token tag" style=color:#fc929e>div</span><span class="token tag" style=color:#fc929e> </span><span class="token tag attr-name" style=color:#c5a5c5>className</span><span class="token tag attr-value punctuation attr-equals" style=color:#8dc891>=</span><span class="token tag attr-value punctuation" style=color:#8dc891>'</span><span class="token tag attr-value" style=color:#8dc891>counter</span><span class="token tag attr-value punctuation" style=color:#8dc891>'</span><span class="token tag punctuation" style=color:#8dc891>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#8dc891>&lt;</span><span class="token tag" style=color:#fc929e>button</span><span class="token tag" style=color:#fc929e> </span><span class="token tag attr-name" style=color:#c5a5c5>onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#8dc891>=</span><span class="token tag script language-javascript punctuation" style=color:#8dc891>{</span><span class="token tag script language-javascript" style=color:#fc929e>decrement</span><span class="token tag script language-javascript punctuation" style=color:#8dc891>}</span><span class="token tag punctuation" style=color:#8dc891>></span><span class="token plain-text">-</span><span class="token tag punctuation" style=color:#8dc891>&lt;/</span><span class="token tag" style=color:#fc929e>button</span><span class="token tag punctuation" style=color:#8dc891>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#8dc891>&lt;</span><span class="token tag" style=color:#fc929e>h1</span><span class="token tag punctuation" style=color:#8dc891>></span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain">count</span><span class="token punctuation" style=color:#8dc891>}</span><span class="token tag punctuation" style=color:#8dc891>&lt;/</span><span class="token tag" style=color:#fc929e>h1</span><span class="token tag punctuation" style=color:#8dc891>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#8dc891>&lt;</span><span class="token tag" style=color:#fc929e>button</span><span class="token tag" style=color:#fc929e> </span><span class="token tag attr-name" style=color:#c5a5c5>onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#8dc891>=</span><span class="token tag script language-javascript punctuation" style=color:#8dc891>{</span><span class="token tag script language-javascript" style=color:#fc929e>increment</span><span class="token tag script language-javascript punctuation" style=color:#8dc891>}</span><span class="token tag punctuation" style=color:#8dc891>></span><span class="token plain-text">+</span><span class="token tag punctuation" style=color:#8dc891>&lt;/</span><span class="token tag" style=color:#fc929e>button</span><span class="token tag punctuation" style=color:#8dc891>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain-text">    </span><span class="token tag punctuation" style=color:#8dc891>&lt;/</span><span class="token tag" style=color:#fc929e>div</span><span class="token tag punctuation" style=color:#8dc891>></span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain"></span><span class="token punctuation" style=color:#8dc891>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=è¤‡è£½ç¨‹å¼ç¢¼è‡³å‰ªè²¼ç°¿ title=è¤‡è£½ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style=--prism-background-color:#282c34;--prism-color:#ffffff><div class=codeBlockTitle_Ktv7>Total.js</div><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-jsx codeBlock_bY9V thin-scrollbar" style=background-color:#282c34;color:#ffffff><code class=codeBlockLines_e6Vv><span class=token-line style=color:#ffffff><span class="token keyword module" style=color:#c5a5c5>import</span><span class="token plain"> </span><span class="token imports punctuation" style=color:#8dc891>{</span><span class="token imports"> useCountStore </span><span class="token imports punctuation" style=color:#8dc891>}</span><span class="token plain"> </span><span class="token keyword module" style=color:#c5a5c5>from</span><span class="token plain"> </span><span class="token string" style=color:#8dc891>"./store"</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain"></span><span class="token keyword module" style=color:#c5a5c5>export</span><span class="token plain"> </span><span class="token keyword module" style=color:#c5a5c5>default</span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>function</span><span class="token plain"> </span><span class="token function maybe-class-name" style=color:#79b6f2>Total</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"> count </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>useCountStore</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword control-flow" style=color:#c5a5c5>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token tag punctuation" style=color:#8dc891>&lt;</span><span class="token tag" style=color:#fc929e>div</span><span class="token tag punctuation" style=color:#8dc891>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#8dc891>&lt;</span><span class="token tag" style=color:#fc929e>h1</span><span class="token tag punctuation" style=color:#8dc891>></span><span class="token plain-text">Total Count: </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain">count</span><span class="token punctuation" style=color:#8dc891>}</span><span class="token tag punctuation" style=color:#8dc891>&lt;/</span><span class="token tag" style=color:#fc929e>h1</span><span class="token tag punctuation" style=color:#8dc891>></span><span class="token plain-text"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain-text">    </span><span class="token tag punctuation" style=color:#8dc891>&lt;/</span><span class="token tag" style=color:#fc929e>div</span><span class="token tag punctuation" style=color:#8dc891>></span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain"></span><span class="token punctuation" style=color:#8dc891>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=è¤‡è£½ç¨‹å¼ç¢¼è‡³å‰ªè²¼ç°¿ title=è¤‡è£½ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>é€™å…©å€‹å…ƒä»¶éƒ½å‘¼å«äº† <code>useCountStore</code> ä¾†å–å¾— count çš„å€¼ï¼Œå‰é¢æåˆ° <code>useCountStore</code>
æœƒå‘¼å« <code>useSyncExternalStore</code> ä¾†æŠŠ <span class="highlight-yellow highlight" style=font-weight:normal>æ›´æ–°å‡½å¼</span> åŠ å…¥åˆ° listeners
è£¡é¢ï¼Œæ‰€ä»¥ç•¶ç•«é¢æ¸²æŸ“æ™‚ï¼Œlisteners æœƒæœ‰å…©å€‹ updator å‡½å¼ï¼Œè€Œç•¶ Counter å‘¼å«äº† <code>increment</code> æˆ– <code>decrement</code> æ™‚ï¼Œæœƒè§¸ç™¼ zustand
å…§éƒ¨çš„ <code>setState</code>ï¼Œé€™æ™‚å€™æœƒå…ˆæ›´æ–° state çš„å€¼ï¼Œç„¶å¾ŒåŸ·è¡Œ listeners è£¡é¢çš„æ‰€æœ‰ updator
å‡½å¼ï¼Œé€™æ¨£å°±æœƒè®“æ‰€æœ‰ä½¿ç”¨äº†é€™å€‹ state çš„å…ƒä»¶éƒ½é‡æ–° renderã€‚</p>
<img src=/assets/images/muti-component-flow-4f3d858786b3f0a399ad53c916acecd8.gif style="width:min(100%,100%);display:block;margin:0 auto;border-radius:5px"><br><br>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=zustand-æ¿ƒç¸®ç‰ˆ>zustand æ¿ƒç¸®ç‰ˆ<a href=#zustand-æ¿ƒç¸®ç‰ˆ class=hash-link aria-label="zustand æ¿ƒç¸®ç‰ˆçš„ç›´æ¥é€£çµ" title="zustand æ¿ƒç¸®ç‰ˆçš„ç›´æ¥é€£çµ">â€‹</a></h2>
<p>å¦‚æœæŠŠ zustand çš„åŸå§‹ç¢¼åªä¿ç•™æ ¸å¿ƒåŠŸèƒ½ï¼Œæœƒè®Šæˆé€™æ¨£ï¼š</p>
<ol>
<li>create</li>
</ol>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-background-color:#282c34;--prism-color:#ffffff><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=background-color:#282c34;color:#ffffff><code class=codeBlockLines_e6Vv><span class=token-line style=color:#ffffff><span class="token keyword" style=color:#c5a5c5>export</span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> </span><span class="token function-variable function" style=color:#79b6f2>create</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">createState</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> api </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>createStore</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">createState</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>useStore</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">api</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain"></span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=è¤‡è£½ç¨‹å¼ç¢¼è‡³å‰ªè²¼ç°¿ title=è¤‡è£½ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol start=2>
<li>createStore</li>
</ol>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-background-color:#282c34;--prism-color:#ffffff><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=background-color:#282c34;color:#ffffff><code class=codeBlockLines_e6Vv><span class=token-line style=color:#ffffff><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> </span><span class="token function-variable function" style=color:#79b6f2>createStore</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">createState</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>let</span><span class="token plain"> state </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> listeners </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>new</span><span class="token plain"> </span><span class="token class-name" style=color:#FAC863>Set</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> </span><span class="token function-variable function" style=color:#79b6f2>setState</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">partial</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> nextState </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>partial</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">state</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    state </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>...</span><span class="token plain">state</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>...</span><span class="token plain">nextState </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    listeners</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token function" style=color:#79b6f2>forEach</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">listener</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>listener</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> </span><span class="token function-variable function" style=color:#79b6f2>getState</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> state</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> </span><span class="token function-variable function" style=color:#79b6f2>subscribe</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">listener</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    listeners</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token function" style=color:#79b6f2>add</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">listener</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">    </span><span class="token keyword" style=color:#c5a5c5>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>(</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token operator" style=color:#d7deea>=></span><span class="token plain"> listeners</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token function" style=color:#79b6f2>delete</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">listener</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  state </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>createState</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">setState</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> api </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"> setState</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> getState</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> subscribe </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>return</span><span class="token plain"> api</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain"></span><span class="token punctuation" style=color:#8dc891>}</span><span class="token punctuation" style=color:#8dc891>;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=è¤‡è£½ç¨‹å¼ç¢¼è‡³å‰ªè²¼ç°¿ title=è¤‡è£½ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ol start=3>
<li>useStore</li>
</ol>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-background-color:#282c34;--prism-color:#ffffff><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=background-color:#282c34;color:#ffffff><code class=codeBlockLines_e6Vv><span class=token-line style=color:#ffffff><span class="token keyword" style=color:#c5a5c5>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"> useSyncExternalStore </span><span class="token punctuation" style=color:#8dc891>}</span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>from</span><span class="token plain"> </span><span class="token string" style=color:#8dc891>"react"</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#ffffff><span class="token plain"></span><span class="token keyword" style=color:#c5a5c5>export</span><span class="token plain"> </span><span class="token keyword" style=color:#c5a5c5>function</span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>useStore</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">api</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#8dc891>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>const</span><span class="token plain"> entireState </span><span class="token operator" style=color:#d7deea>=</span><span class="token plain"> </span><span class="token function" style=color:#79b6f2>useSyncExternalStore</span><span class="token punctuation" style=color:#8dc891>(</span><span class="token plain">api</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token plain">subscribe</span><span class="token punctuation" style=color:#8dc891>,</span><span class="token plain"> api</span><span class="token punctuation" style=color:#8dc891>.</span><span class="token plain">getState</span><span class="token punctuation" style=color:#8dc891>)</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#ffffff><span class="token plain">  </span><span class="token keyword" style=color:#c5a5c5>return</span><span class="token plain"> entireState</span><span class="token punctuation" style=color:#8dc891>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#ffffff><span class="token plain"></span><span class="token punctuation" style=color:#8dc891>}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label=è¤‡è£½ç¨‹å¼ç¢¼è‡³å‰ªè²¼ç°¿ title=è¤‡è£½ class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=zustand-æ¶æ§‹æ¨¡å¼>zustand æ¶æ§‹æ¨¡å¼<a href=#zustand-æ¶æ§‹æ¨¡å¼ class=hash-link aria-label="zustand æ¶æ§‹æ¨¡å¼çš„ç›´æ¥é€£çµ" title="zustand æ¶æ§‹æ¨¡å¼çš„ç›´æ¥é€£çµ">â€‹</a></h2>
<p>Zustand çš„åœ¨ <a href=https://docs.pmnd.rs/zustand/guides/flux-inspired-practice target=_blank rel="noopener noreferrer">Flux inspired practice</a> æœ‰æåˆ°ï¼š</p>
<blockquote>
<p>Although Zustand is an unopinionated library, we do recommend a few patterns. These are inspired by practices originally found in Flux, and more recently Redux, so if you are coming from another library, you should feel right at home.</p>
</blockquote>
<p>æ„æ€æ˜¯ Zustand æœ¬èº«ä¸¦æ²’æœ‰å¼·åˆ¶è¦æ±‚ä½¿ç”¨è€…éµå¾ªä»»ä½•ç‰¹å®šçš„æ¶æ§‹æ¨¡å¼ï¼Œä½†æ˜¯å»ºè­°ä½¿ç”¨è€…å¯ä»¥åƒè€ƒ Flux æˆ– Redux çš„ä¸€äº›å¯¦è¸æ–¹å¼ã€‚Redux åœ¨å­¸ React çš„æ™‚å€™æ‡‰è©²éƒ½æœ‰è½éï¼Œé‚£é€™å€‹ <strong>Flux</strong> æ˜¯ä»€éº¼å‘¢ï¼Ÿ</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=flux>Flux<a href=#flux class=hash-link aria-label=Fluxçš„ç›´æ¥é€£çµ title=Fluxçš„ç›´æ¥é€£çµ>â€‹</a></h3>
<p>Flux æ˜¯ä¸€ç¨®æ¶æ§‹æ¨¡å¼ï¼Œé‚£ä»€éº¼æ˜¯æ¶æ§‹æ¨¡å¼å‘¢ï¼Ÿæ¯”è¼ƒå¸¸è½åˆ°çš„ä¾‹å­å°±æ˜¯ MVCï¼Œæ¶æ§‹æ¨¡å¼çš„ç›®çš„æ˜¯ç”¨ä¾†å¹«åŠ©æˆ‘å€‘å¯ä»¥æ›´å¥½çš„çµ„ç¹”ç¨‹å¼ç¢¼ï¼Œè®“ç¨‹å¼ç¢¼æ›´åŠ å®¹æ˜“ç¶­è­·ã€æ“´å……ã€‚è€Œ Flux å‰‡æ˜¯å¾ MVC æ‰€å•Ÿç™¼å‡ºä¾†çš„ä¸€ç¨®æ¶æ§‹æ¨¡å¼ã€‚</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>MVC</div><div class=admonitionContent_BuS1><p>MVC æ¨¡å¼æœ€æ—©ç”± Trygve Reenskaug åœ¨ 1978 å¹´æå‡ºï¼Œä¸¦ä¸”åœ¨ University of Oslo æœ‰ç•™ä¸‹<a href="https://www.duo.uio.no/bitstream/handle/10852/9621/Reenskaug-MVC.pdf?sequence=1&isAllowed=y" target=_blank rel="noopener noreferrer">ç ”ç©¶å ±å‘Š</a>ï¼Œä»–æŠŠæ‡‰ç”¨ç¨‹å¼åˆ†ç‚ºä¸‰å€‹éƒ¨åˆ†ï¼š<ol>
<li>Model: è² è²¬è™•ç†è³‡æ–™</li>
<li>View: è² è²¬é¡¯ç¤ºç•«é¢</li>
<li>Controller: è² è²¬è™•ç† View çš„äº‹ä»¶ï¼Œä¹Ÿæœƒèªªæ˜¯ View åŠ Model ä¹‹é–“çš„æ©‹æ¨‘</li>
</ol><p>MVC çš„å¥½è™•æ˜¯å¯ä»¥è®“ç¨‹å¼ç¢¼æ›´åŠ æ¨¡çµ„åŒ–ï¼Œæ¯å€‹éƒ¨åˆ†éƒ½æœ‰è‡ªå·±çš„è²¬ä»»ï¼Œä¸æœƒäº’ç›¸å¹²æ“¾ï¼Œä¹Ÿè®“ç¨‹å¼ç¢¼æ›´å®¹æ˜“ç¶­è­·ã€‚</div></div>
<p>é›–ç„¶ MVC çš„æ¶æ§‹å®šç¾©äº†ä¸‰å€‹éƒ¨åˆ†çš„è·è²¬ï¼Œä¸éå°æ–¼ä¸‰å€‹éƒ¨åˆ†ä¹‹é–“çš„æºé€šæ–¹å¼ä¸¦æ²’æœ‰æ˜ç¢ºçš„å®šç¾©ï¼Œæ‰€ä»¥åœ¨å¯¦éš›æ‡‰ç”¨æ™‚ï¼Œå¯èƒ½æœƒæœ‰ä¸åŒçš„å¯¦ä½œæ–¹å¼ï¼Œé€™ä¹Ÿæ˜¯ç‚ºä»€éº¼æœ‰å¾ˆå¤šä¸åŒçš„ MVC è®Šé«”ï¼Œåƒæ˜¯ MVPã€MVVM ç­‰ç­‰ï¼Œè€Œ Flux çš„å‡ºç¾å°±æ˜¯ç‚ºäº†è§£æ±º MVC åœ¨è³‡æ–™æµä¸Šä¸å¥½è¿½è¹¤çš„å•é¡Œã€‚</p>
<p>Flux æ˜¯ React åœ¨ 2014 å¹´çš„ <a href="https://www.youtube.com/watch?v=nYkdrAPrdcw&ab_channel=MetaDevelopers" target=_blank rel="noopener noreferrer">Hacker Way conference</a> ä¸Šæå‡ºçš„æ¦‚å¿µï¼Œç‚ºçš„å°±æ˜¯è§£æ±º Facebook åœ¨ä½¿ç”¨ MVC æ¶æ§‹æ‰€é‡åˆ°çš„å•é¡Œã€‚Facebook æœ€åˆæ˜¯ä½¿ç”¨é›™å‘ç¶å®šçš„æ–¹å¼é€²è¡Œè³‡æ–™å‚³éï¼Œä½†éš¨è‘—å°ˆæ¡ˆè¶Šä¾†è¶Šå¤§ï¼Œè³‡æ–™æµè®Šå¾—è¶Šä¾†è¶Šè¤‡é›œã€‚</p>
<img src=/assets/images/mvc-problem-6c68826c5322aefe4d904b59e31f7cb3.jpg style=width:min(100%,100%);display:inline-block;margin:0;border-radius:5px><br><br>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>å°çˆ­è­°</div><div class=admonitionContent_BuS1><p>é€™å¼µåœ–åœ¨ç•¶æ™‚å¼•èµ·ä¸å°‘çš„<a href=https://www.reddit.com/r/programming/comments/25nrb5/facebook_mvc_does_not_scale_use_flux_instead/ target=_blank rel="noopener noreferrer">è¨è«–</a>ï¼Œæœ‰äººèªç‚º facebook çš„ MVC åœ–æ˜¯éŒ¯çš„ï¼ŒçœŸæ­£çš„ MVC æ‰ä¸æœƒåªæœ‰ä¸€å€‹ controllerï¼Œä¹Ÿæœ‰äººèªç‚º Flux æ ¹æœ¬åªæ˜¯ MVC æ›å€‹åè©ã€‚<p>è€Œç•¶æ™‚çš„æ¼”è¬›è€… Jing Chen ä¹Ÿæœ‰å‡ºä¾†<a href="https://www.reddit.com/r/programming/comments/25nrb5/comment/chjbo05/?utm_source=share&utm_medium=web3x&utm_name=web3xcss&utm_term=1&utm_content=share_button" target=_blank rel="noopener noreferrer">èªªæ˜</a>ï¼Œé€™å¼µåœ–çš„ç¢ºæ˜¯æœ‰é»æŠ•æ©Ÿå–å·§ï¼Œä¸éé‡é»é‚„æ˜¯åœ¨æ–¼é›™å‘è³‡æ–™æµæ‰€é€ æˆçš„å•é¡Œï¼Œè€Œ Flux ä¸­çš„ dispatcher ä¸¦ä¸ç­‰åŒæ–¼ controllerï¼Œä»–åªæ˜¯ä¸€å€‹åˆ†ç™¼ action çš„ callback ä¾†é”æˆå–®å‘è³‡æ–™æµçš„ç›®çš„ã€‚</div></div>
<p>meta å·¥ç¨‹å¸«èˆ‰çš„å¯¦éš›ä¾‹å­æ˜¯ç•¶åˆåš message chat çš„æ™‚å€™ï¼Œä¸€é–‹å§‹åªæœ‰ä¸€å€‹å€å¡Šè·Ÿè¨Šæ¯æœ‰é—œï¼Œä½†å¾Œä¾†è¶Šä¾†è¶Šå¤šåŠŸèƒ½æœƒå°è¨Šæ¯çš„æ•¸é‡é€ æˆå½±éŸ¿ã€‚</p>
<p>è€Œé‡åˆ°çš„ bug å°±æ˜¯<strong>æœªè®€è¨Šæ¯</strong>çš„æ•¸å­—ä¸æº–ç¢ºï¼Œå› ç‚ºå¾ˆå¤šçš„å€å¡Šéƒ½æœ‰å¯èƒ½æœƒå½±éŸ¿åˆ°æœªè®€è¨Šæ¯çš„æ•¸å­—ï¼Œæ‰€ä»¥è¦è¿½è¹¤åˆ°åº•æ˜¯å“ªå€‹å€å¡Šé€ æˆçš„ bug å°±è®Šå¾—éå¸¸å›°é›£ï¼Œè€Œ meta æ¯æ¬¡é‡åˆ°é€™å€‹ bug éƒ½æ˜¯å»è§£æ±ºé‚£äº› edge case (é‚Šç•Œæ¡ˆä¾‹)ï¼Œæ²’æœ‰çœŸçš„è§£æ±ºæ ¸å¿ƒå•é¡Œï¼Œæ‰€ä»¥å°è‡´æ¯æ¬¡æ–°å¢åŠŸèƒ½éƒ½æœƒæœ‰æ–°çš„ bug ç”¢ç”Ÿã€‚</p>
<img src=/assets/images/fb-message-block-6ff5ff6f29dbc170f194443c2085f871.png style=width:min(100%,100%);display:inline-block;margin:0;border-radius:5px><br><br>
<p>ä»–å€‘èªç‚ºé€™æ˜¯å› ç‚º MVC çš„é›™å‘ç¶å®šé€ æˆçš„ï¼Œç•¶è³‡æ–™æµè®Šå¾—è¶Šä¾†è¶Šè¤‡é›œæ™‚ï¼Œå°±æœƒè®Šå¾—éå¸¸é›£ä»¥è¿½è¹¤ï¼Œæ‰€ä»¥æå‡ºäº† Flux çš„<strong>å–®å‘è³‡æ–™æµ</strong>çš„æ¶æ§‹ã€‚</p>
<p>Flux å°‡è³‡æ–™æµçš„å‚³éåˆ†ç‚ºå››å€‹éƒ¨åˆ†ï¼š</p>
<ol>
<li>Actionï¼šç‰©ä»¶çµæ§‹åŒ…å«è¡Œç‚ºå®šç¾©åŠå‚³éçš„è³‡è¨Š</li>
<li>Dispatcherï¼šè² è²¬åˆ†ç™¼ Action çš„å‡½å¼</li>
<li>Storeï¼šå„²å­˜è³‡æ–™åŠå›æ‡‰ Action çš„è¡Œç‚º</li>
<li>é¡¯ç¤º Store æä¾›çš„è³‡æ–™ç•«é¢</li>
</ol>
<img src=/assets/images/flux-flow-61e705f06287ccfbaa6e59f5b958145b.png style=width:min(100%,100%);display:inline-block;margin:0;border-radius:5px><br><br>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=redux>Redux<a href=#redux class=hash-link aria-label=Reduxçš„ç›´æ¥é€£çµ title=Reduxçš„ç›´æ¥é€£çµ>â€‹</a></h3>
<p>åœ¨æå‡º Flux æ¶æ§‹çš„åŒæ™‚ï¼Œmeta ä¹Ÿæå‡ºäº†ä¸€å€‹å« <a href=https://facebookarchive.github.io/flux/ target=_blank rel="noopener noreferrer">Flux</a> çš„ libraryï¼Œä¸éä¸¦æ²’æœ‰å—åˆ°å¤ªå¤šçš„é—œæ³¨ï¼Œç›´åˆ°éš”ä¸€å¹´ Dan Abramov æå‡ºäº†åŸºæ–¼ Flux æ¦‚å¿µå¯¦ä½œçš„ library <a href=https://redux.js.org/ target=_blank rel="noopener noreferrer">Redux</a>ï¼Œé€™å€‹ library å¾Œä¾†æˆç‚ºäº† React æœ€å—æ­¡è¿çš„ç‹€æ…‹ç®¡ç† library ä¹‹ä¸€ã€‚</p>
<p>åœ¨ Redux çš„<a href=https://redux.js.org/tutorials/fundamentals/part-2-concepts-data-flow#redux-application-data-flow target=_blank rel="noopener noreferrer">å®˜ç¶²</a>å¯ä»¥æ˜ç¢ºçš„çœ‹åˆ°æ•´å€‹ redux çš„è³‡æ–™æµï¼š</p>
<img src=/assets/images/redux-flow-49fa8c3968371d9ef6f2a1486bd40a26.gif style=width:min(100%,100%);display:inline-block;margin:0;border-radius:5px><br><br>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=ç¸½çµ>ç¸½çµ<a href=#ç¸½çµ class=hash-link aria-label=ç¸½çµçš„ç›´æ¥é€£çµ title=ç¸½çµçš„ç›´æ¥é€£çµ>â€‹</a></h2>
<p>å…¶å¯¦å…‰çœ‹ Flux åŠ Redux çš„åœ–ï¼Œæœƒè¦ºå¾—å¥½åƒè·Ÿ MVC æ²’æœ‰ä»€éº¼å·®åˆ¥ï¼Œä¹Ÿæ˜¯å®šç¾©å€‹åˆ¥çš„è·è²¬ï¼ŒView è·Ÿ Model åˆ†é–‹ï¼Œä¹Ÿæœ‰é¡ä¼¼ controller çš„æ±è¥¿ã€‚ä¸éé‡é»åœ¨æ–¼å®ƒæ›´åŠ åš´è¬¹çš„å®šç¾©äº†è³‡æ–™æµçš„æ–¹å‘ï¼Œè®“è³‡æ–™æ›´å¥½çš„çµ±ä¸€ï¼Œé›–ç„¶ MVC æ¶æ§‹ä¹Ÿè¾¦å¾—åˆ°é€™ä»¶äº‹ï¼Œä½†ä¸¦ä¸æ˜¯æ¯å€‹äººéƒ½æœƒé€™éº¼åšï¼Œæ‰€ä»¥æˆ‘èªçˆ² Flux é‚„æ˜¯è·Ÿ MVC æœ‰æ‰€å€åˆ¥ã€‚</p>
<p>å›åˆ° zustandï¼Œä¹‹æ‰€ä»¥èƒ½å¤ å¯«çš„é‚£éº¼ç°¡æ½”æ–¹é‚Šä½¿ç”¨ï¼Œæ˜¯å› ç‚ºä»–ä¸¦ä¸æ˜¯å®Œå…¨çš„å¯¦ä½œäº† Fluxï¼Œä»–æ¨æ£„äº† Flux ä¸­çš„ Action åŠ Dispatcherï¼Œåªä¿ç•™äº† Store çš„éƒ¨åˆ†ï¼Œåœ¨ DX (Developer Experience) ä¸Šçš„é«”é©—å°±æ¯”è¼ƒå¥½ï¼Œè€Œé›–ç„¶ä¸æ˜¯åš´è¬¹çš„ Flux æ¶æ§‹ï¼Œä½†é‚„æ˜¯éµå¾ªè‘—æœ€åŸºæœ¬çš„å–®å‘è³‡æ–™æµçš„åŸå‰‡ï¼Œè®“æˆ‘å€‘å¯ä»¥æ›´å¥½çš„é€²è¡Œç®¡ç†ç‹€æ…‹ã€‚</p>
<p>ç¸½è€Œè¨€ä¹‹ï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨ React åŸç”Ÿçš„ useContextï¼Œè€Œå­¸ç¿’ Redux çš„å…¥é–€åˆæœ‰é»å¤ªé«˜ï¼Œzustand æ˜¯ä¸€å€‹å¾ˆå¥½çš„é¸æ“‡ï¼Œåœ¨åš side project æˆ–æ˜¯å°å‹å°ˆæ¡ˆçµ•å°æ˜¯éå¸¸å¤ ç”¨çš„ï¼Œè€Œä¸”ä¹Ÿå¯ä»¥è®“ä½ å°ç‹€æ…‹ç®¡ç†æœ‰æ›´æ·±çš„äº†è§£ï¼</p>
<p>æœ‰ä»»ä½•å•é¡Œæˆ–æ˜¯å…§å®¹æœ‰èª¤çš„åœ°æ–¹ï¼Œæ­¡è¿åœ¨åº•ä¸‹ç•™è¨€ ~</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=åƒè€ƒè³‡æ–™>åƒè€ƒè³‡æ–™<a href=#åƒè€ƒè³‡æ–™ class=hash-link aria-label=åƒè€ƒè³‡æ–™çš„ç›´æ¥é€£çµ title=åƒè€ƒè³‡æ–™çš„ç›´æ¥é€£çµ>â€‹</a></h2>
<ul>
<li><a href=https://medium.com/%E6%89%8B%E5%AF%AB%E7%AD%86%E8%A8%98/a-comparison-of-react-state-management-libraries-ba61db07332b target=_blank rel="noopener noreferrer">React ç‹€æ…‹ç®¡ç†å¥—ä»¶æ¯”è¼ƒèˆ‡åŸç†å¯¦ç¾ feat. Redux, Zustand, Jotai, Recoil, MobX, Valtio</a></li>
<li><a href=https://juejin.cn/post/7178318352174022717 target=_blank rel="noopener noreferrer">æ˜¯æ—¶å€™æ”¾å¼ƒ redux äº†ï¼Œzustand æ˜¯å®Œç¾æ›¿ä»£è€…ï¼ˆä¸»è¦æ˜¯æºç åˆ†æï¼‰</a></li>
<li><a href=https://medium.com/wix-engineering/the-rise-of-flux-how-facebooks-shift-away-from-mvc-led-to-a-new-era-of-ui-architecture-61d78b4377b0 target=_blank rel="noopener noreferrer">The Rise of Flux: How Facebookâ€™s Shift Away from MVC Led to a New Era of UI Architecture</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class=col><b>æ¨™ç±¤ï¼š</b><ul class="tags_jXut padding--none margin-left--sm"><li class=tag_QGVx><a class="tag_d0Lz tagRegular_bmnp" href=/tags/react>React</a><li class=tag_QGVx><a class="tag_d0Lz tagRegular_bmnp" href=/tags/zustand>Zustand</a><li class=tag_QGVx><a class="tag_d0Lz tagRegular_bmnp" href=/tags/source-code>Source Code</a></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col></div><div class="col lastUpdated_JAkA"><span class=theme-last-updated>æœ€å¾Œ<!-- -->æ–¼ <b><time datetime=2025-02-04T08:24:03.000Z itemprop=dateModified>2025å¹´2æœˆ4æ—¥</time></b> <!-- -->æ›´æ–°</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label=æ–‡ä»¶é¸é …å¡><a class="pagination-nav__link pagination-nav__link--prev" href=/react/zustand><div class=pagination-nav__sublabel>ä¸Šä¸€é </div><div class=pagination-nav__label>Zustand</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/category/typescript><div class=pagination-nav__sublabel>ä¸‹ä¸€é </div><div class=pagination-nav__label>TypeScript</div></a></nav></div><br></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#åŸå§‹ç¢¼è§£æ class="table-of-contents__link toc-highlight">åŸå§‹ç¢¼è§£æ</a><ul><li><a href=#create-reactts class="table-of-contents__link toc-highlight">create (react.ts)</a><li><a href=#createstore-vanillats class="table-of-contents__link toc-highlight">createStore (vanilla.ts)</a><li><a href=#usestore-reactts class="table-of-contents__link toc-highlight">useStore (react.ts)</a><li><a href=#usesyncexternalstore class="table-of-contents__link toc-highlight">useSyncExternalStore</a><li><a href=#zustand-å…§éƒ¨è¨‚é–±æµç¨‹åœ– class="table-of-contents__link toc-highlight">zustand å…§éƒ¨è¨‚é–±æµç¨‹åœ–</a><li><a href=#zustand-æ›´æ–°-state-æµç¨‹åœ– class="table-of-contents__link toc-highlight">zustand æ›´æ–° state æµç¨‹åœ–</a></ul><li><a href=#zustand-æ¿ƒç¸®ç‰ˆ class="table-of-contents__link toc-highlight">zustand æ¿ƒç¸®ç‰ˆ</a><li><a href=#zustand-æ¶æ§‹æ¨¡å¼ class="table-of-contents__link toc-highlight">zustand æ¶æ§‹æ¨¡å¼</a><ul><li><a href=#flux class="table-of-contents__link toc-highlight">Flux</a><li><a href=#redux class="table-of-contents__link toc-highlight">Redux</a></ul><li><a href=#ç¸½çµ class="table-of-contents__link toc-highlight">ç¸½çµ</a><li><a href=#åƒè€ƒè³‡æ–™ class="table-of-contents__link toc-highlight">åƒè€ƒè³‡æ–™</a></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class=footer__copyright>Copyright Â© 2025 Jim's note, Inc. Built with Docusaurus.</div></div></div></footer></div>