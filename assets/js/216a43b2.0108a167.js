"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["9383"],{6999:function(e,n,r){r.r(n),r.d(n,{default:()=>x,frontMatter:()=>d,metadata:()=>t,assets:()=>a,toc:()=>p,contentTitle:()=>h});var t=JSON.parse('{"id":"other/cors","title":"\u7814\u7A76 CORS \u7684\u7591\u96E3\u96DC\u75C7","description":"CORS \u4E0D\u8AD6\u524D\u7AEF\u6216\u5F8C\u7AEF\u90FD\u662F\u65B0\u624B\u5F88\u5BB9\u6613\u9047\u5230\u7684\u554F\u984C\uFF0C\u5148\u8AAA\u500B\u7D50\u8AD6\uFF1A","source":"@site/docs/other/cors.mdx","sourceDirName":"other","slug":"/other/cors","permalink":"/other/cors","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1738744955000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Other","permalink":"/category/other"},"next":{"title":"\u8A2D\u5B9A GPG \u4F86\u8B93\u4F60\u7684 commit \u52A0\u4E0A\u7C3D\u540D","permalink":"/other/gpg"}}'),s=r("5893"),o=r("65"),i=r("8239");let c=r.p+"assets/images/cors-1-f9608e6af1f4b02707c3944e5112e9ba.jpg",l=r.p+"assets/images/cors-2-08a7dd85704a1af5f9aa6c7ace2e1d07.jpg",d={},h="\u7814\u7A76 CORS \u7684\u7591\u96E3\u96DC\u75C7",a={},p=[{value:"no-cors \u76EE\u7684",id:"no-cors-\u76EE\u7684",level:2},{value:"\u7C21\u55AE\u8ACB\u6C42\u8207\u975E\u7C21\u55AE\u8ACB\u6C42",id:"\u7C21\u55AE\u8ACB\u6C42\u8207\u975E\u7C21\u55AE\u8ACB\u6C42",level:2},{value:"proxy \u4E0D\u6703\u6709\u554F\u984C\u55CE",id:"proxy-\u4E0D\u6703\u6709\u554F\u984C\u55CE",level:2}];function u(e){let n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u7814\u7A76-cors-\u7684\u7591\u96E3\u96DC\u75C7",children:"\u7814\u7A76 CORS \u7684\u7591\u96E3\u96DC\u75C7"})}),"\n",(0,s.jsx)(n.p,{children:"CORS \u4E0D\u8AD6\u524D\u7AEF\u6216\u5F8C\u7AEF\u90FD\u662F\u65B0\u624B\u5F88\u5BB9\u6613\u9047\u5230\u7684\u554F\u984C\uFF0C\u5148\u8AAA\u500B\u7D50\u8AD6\uFF1A"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"CORS \u7684\u554F\u984C\u8207\u524D\u7AEF\u7121\u95DC\uFF0C\u4E3B\u8981\u8A2D\u5B9A\u662F\u5728\u5F8C\u7AEF\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679C\u60F3\u77E5\u9053\u66F4\u591A\u95DC\u65BC CORS \u7684\u554F\u984C\uFF0CHuli \u5728 2021 \u5BEB\u7684\u9019\u7BC7 ",(0,s.jsx)(n.a,{href:"https://blog.huli.tw/2021/02/19/cors-guide-1/",children:"CORS \u5B8C\u5168\u624B\u518A"})," \u5C31\u5B8C\u5168\u5920\u7528\u4E86\uFF01"]}),"\n",(0,s.jsx)(n.p,{children:"\u672C\u4F86\u662F\u60F3\u5BEB\u81EA\u5DF1\u5BEB\u4E00\u7BC7\u95DC\u65BC CORS \u7684\u6587\u7AE0\uFF0C\u4F46\u662F\u5927\u795E\u5BEB\u7684\u592A\u4ED4\u7D30...\u81EA\u5DF1\u5BEB\u9084\u4E0D\u5982\u76F4\u63A5\u9023\u7D50\u904E\u53BB\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u90A3\u9019\u4E00\u7BC7\u5B58\u5728\u7684\u76EE\u7684\u5728\u54EA\u5462\uFF1F\u4E3B\u8981\u662F\u7D00\u9304\u5728\u770B\u9019\u7CFB\u5217\u6587\u7AE0\u6642\uFF0C\u7522\u751F\u7684\u7591\u554F\u4EE5\u53CA\u81EA\u5DF1\u5BE6\u969B\u5BE6\u4F5C\u6642\u7684\u4E00\u4E9B\u5C0F\u7D00\u9304\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"no-cors-\u76EE\u7684",children:"no-cors \u76EE\u7684"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728",(0,s.jsx)(n.a,{href:"https://blog.huli.tw/2021/02/19/cors-guide-2/#%E8%A7%A3%E6%B3%95%E4%BA%8C%E6%8A%8A-fetch-mode-%E8%A8%AD%E6%88%90-no-cors",children:"\u6587\u7AE0"}),"\u4E2D\u63D0\u5230\uFF0C\u7576\u8A2D\u5B9A ",(0,s.jsx)(n.code,{children:"fetch"})," \u7684 ",(0,s.jsx)(n.code,{children:"mode"})," \u70BA ",(0,s.jsx)(n.code,{children:"no-cors"})," \u6642\uFF0C\u57FA\u672C\u4E0A\u7B49\u65BC\u6C92\u4F5C\u7528\uFF0C\u4E0D\u53EA\u7121\u6CD5\u89E3\u6C7A CORS \u7684\u554F\u984C\uFF0C\u9023\u539F\u672C\u540C\u6E90\u7684 request \u4E5F\u6703\u6536\u4E0D\u5230 response\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u90A3\u9019\u6A23\u9019\u500B ",(0,s.jsx)(n.code,{children:"mode: no-cors"})," \u6709\u4EC0\u9EBC\u7528\u5462\uFF1F"]}),"\n",(0,s.jsxs)(n.p,{children:["\u722C\u4E86\u4E00\u4E0B\u6587\u767C\u73FE",(0,s.jsx)(n.a,{href:"https://stackoverflow.com/questions/52569895/fetch-api-why-use-the-no-cors-mode-if-the-response-is-opaque",children:"\u9019\u7BC7"}),"\uFF0C\u770B\u8D77\u4F86\u53EF\u4EE5\u7528\u5728\u4E00\u4E9B\u4E0D\u9700\u8981 response \u7684 request\uFF0C\u4F8B\u5982\u50CF\u662F\u767C\u9001 log \u6216\u662F\u50CF\u662F Google Analytics \u9019\u7A2E\u4E0D\u9700\u8981 response \u7684 request\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u53E6\u5916\u975C\u614B\u8CC7\u6E90\u50CF\u662F\u5716\u7247\u3001\u6A23\u5F0F\u3001JS \u7B49\u7B49\u9810\u8A2D\u5728\u767C\u8ACB\u6C42\u7684\u6642\u5019\uFF0C\u5C31\u662F\u5E36\u4E0A ",(0,s.jsx)(n.code,{children:"no-cors"}),"\uFF0C\u6240\u4EE5\u9019\u4E9B\u8ACB\u6C42\u7684 response \u53EA\u6709\u700F\u89BD\u5668\u624D\u80FD\u770B\u5230\uFF0C\u4E0D\u6703\u88AB JavaScript \u5B58\u53D6\u3002"]}),"\n",(0,s.jsx)(i.Ei,{src:c}),"\n",(0,s.jsxs)(n.p,{children:["\u9664\u6B64\u4E4B\u5916\uFF0C\u56E0\u70BA no-cors \u5C31\u4EE3\u8868\u6211\u4E0D\u60F3\u8981\u770B\u5230 response \u6240\u4EE5\u4E5F\u4E0D\u6703\u767C\u9001",(0,s.jsx)(n.strong,{children:"\u9810\u6AA2\u8ACB\u6C42"}),"\uFF0C\u7B97\u662F\u5176\u4E2D\u4E00\u500B\u597D\u8655\uFF1F"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6240\u4EE5\u770B\u8D77\u4F86 mode \u7684\u9019\u500B options \u672C\u4F86\u5C31\u53EA\u662F\u7D66\u975C\u614B\u8CC7\u6E90\u8F09\u5165\u7528\u7684\uFF0C\u800C\u4E00\u822C js \u767C\u7684\u8ACB\u6C42\u6211\u76F8\u4FE1\u5C31\u7B97\u4E0D\u9700\u8981 response \u4E5F\u4E0D\u6703\u7279\u5225\u6709\u4EBA\u628A\u4ED6\u8A2D\u5B9A\u70BA ",(0,s.jsx)(n.code,{children:"no-cors"}),"\uFF0C\u6240\u4EE5\u9019\u500B options \u5BE6\u969B\u4E0A\u7528\u9014\u4E0D\u5927\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"\u7C21\u55AE\u8ACB\u6C42\u8207\u975E\u7C21\u55AE\u8ACB\u6C42",children:"\u7C21\u55AE\u8ACB\u6C42\u8207\u975E\u7C21\u55AE\u8ACB\u6C42"}),"\n",(0,s.jsxs)(n.p,{children:["\u7C21\u55AE\u8ACB\u6C42\u662F\u6307\u5728",(0,s.jsx)(n.strong,{children:"\u8DE8\u57DF"}),"\u7684 request \u4E2D\u53EA\u6709\u4EE5\u4E0B\u5E7E\u7A2E\u689D\u4EF6\uFF1A"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4F7F\u7528 GET\u3001HEAD\u3001POST \u65B9\u6CD5"}),"\n",(0,s.jsxs)(n.li,{children:["Content-Type \u70BA\u4EE5\u4E0B\u5E7E\u7A2E\uFF1A",(0,s.jsx)(n.code,{children:"application/x-www-form-urlencoded"}),"\u3001",(0,s.jsx)(n.code,{children:"multipart/form-data"}),"\u3001",(0,s.jsx)(n.code,{children:"text/plain"})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u9019\u4E9B\u689D\u4EF6\u90FD\u7B26\u5408\u7684\u8A71\uFF0C\u5C31\u662F\u7C21\u55AE\u8ACB\u6C42\uFF0C\u4E0D\u6703\u89F8\u767C",(0,s.jsx)(n.strong,{children:"\u9810\u6AA2\u8ACB\u6C42"}),"\u3002"]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"\u4E00\u822C\u540C\u6E90\u8ACB\u6C42\u6C92\u6709\u5206\u7C21\u55AE\u8ACB\u6C42\u8207\u975E\u7C21\u55AE\u8ACB\u6C42\u7684\u554F\u984C\u3002"})}),"\n",(0,s.jsxs)(n.p,{children:["\u73FE\u5728 chrome \u7684\u9810\u6AA2\u8ACB\u6C42\u4E0D\u986F\u793A\u5728 Fetch/XHR \u7684\u6B04\u4F4D\uFF0C\u6703\u5728\u540C\u4E00\u500B\u8ACB\u6C42\u4E2D\u7684 Method \u6B04\u4F4D\u5F8C\u9762\u52A0\u4E0A ",(0,s.jsx)(n.code,{children:"+ Preflight"}),"\uFF0C\u5982\u679C\u60F3\u770B Preflight \u7684\u5167\u5BB9\uFF0C\u73FE\u5728\u653E\u5728 ",(0,s.jsx)(n.strong,{children:"Other"})," \u7684\u6B04\u4F4D\u3002"]}),"\n",(0,s.jsx)(i.Ei,{src:l}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"\u8981\u958B\u555F Method \u6B04\u4F4D\uFF0C\u53EF\u4EE5\u5728 Network \u7684\u6B04\u4F4D\u4E2D\u9EDE\u53F3\u9375\uFF0C\u9078\u64C7 Header Options > Method\u3002"})}),"\n",(0,s.jsx)(n.h2,{id:"proxy-\u4E0D\u6703\u6709\u554F\u984C\u55CE",children:"proxy \u4E0D\u6703\u6709\u554F\u984C\u55CE"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728 ",(0,s.jsx)(n.a,{href:"https://blog.huli.tw/2021/02/19/cors-guide-2/#%E4%BD%BF%E7%94%A8-proxy-server",children:"\u6587\u7AE0"})," \u6709\u63D0\u5230\uFF0C\u7528 proxy server \u4F86\u89E3\u6C7A CORS \u7684\u554F\u984C\uFF0C\u4F46\u662F\u9019\u6A23\u6703\u4E0D\u6703\u6709\u5B89\u5168\u6027\u7684\u554F\u984C\u5462\uFF1FHuli \u4EE5 local host \u70BA\u4F8B\uFF0C\u5C31\u7B97\u7528 proxy \u53D6\u5F97\u7684 localhost \u8CC7\u6599\u9084\u662F\u5728 proxy \u4E0A\uFF0C\u5230\u9019\u908A\u6211\u53EF\u4EE5\u7406\u89E3\uFF0C\u4F46\u9084\u662F\u6709\u7591\u554F\u662F\uFF0C\u90A3\u5982\u679C\u662F\u7528 proxy server \u4F86\u53D6\u5F97\u5176\u4ED6\u7DB2\u7AD9\u7684\u8CC7\u6599\u5462\uFF1F"]}),"\n",(0,s.jsx)(n.p,{children:"\u53EF\u80FD\u6709\u4EBA\u770B\u5230\u9019\u908A\u6703\u89BA\u5F97\uFF0C\u9019\u662F\u4EC0\u9EBC\u7B28\u554F\u984C\uFF1F\u4E00\u5B9A\u662F\u6C92\u8FA6\u6CD5\u624D\u6703\u5B58\u5728 proxy server \u554A\uFF01\u5F9E\u7D50\u679C\u4F86\u770B\u7684\u78BA\u662F\u9019\u6A23\u6C92\u932F\uFF0C\u4E0D\u904E\u79C9\u6301\u8457\u6709\u7591\u554F\u5C31\u8981\u4E86\u89E3\u900F\u5FB9\u7684\u7CBE\u795E\uFF0C\u6211\u9084\u662F\u82B1\u4E86\u9EDE\u6642\u9593\u53BB\u67E5\u4E86\u4E00\u4E0B\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u5F9E proxy server \u67E5\u5230 cookie \u518D\u5230 CSRF\uFF0C\u5F8C\u4F86\u624D\u767C\u73FE\u5982\u679C\u7406\u89E3 ",(0,s.jsx)(n.a,{href:"https://blog.techbridge.cc/2017/02/25/csrf-introduction/",children:"CSRF"})," \u5C31\u6703\u77E5\u9053\uFF0Cproxy server \u4E26\u4E0D\u6703\u6709\u5B89\u5168\u6027\u7684\u554F\u984C\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u4E00\u958B\u59CB\u5148\u5F9E\u8981\u600E\u9EBC\u5132\u5B58\u4F7F\u7528\u8005\u8CC7\u6599\u958B\u59CB\u67E5\uFF0C\u5F88\u591A\u7DB2\u7AD9\u90FD\u6703\u5229\u7528 cookie \u5132\u5B58\u4F7F\u7528\u8005\u7684\u767B\u5165\u8CC7\u6599\uFF0C\u9019\u6A23\u4E0B\u6B21\u518D\u9032\u5165\u6642\uFF0C\u5C31\u53EF\u4EE5\u5E36\u4E0A cookie \u4F86\u8B58\u5225\u4F7F\u7528\u8005\uFF0C\u6240\u4EE5\u5982\u679C\u99ED\u5BA2\u53EF\u4EE5\u53D6\u5F97\u9019\u500B cookie\uFF0C\u5C31\u53EF\u4EE5\u5047\u5192\u4F7F\u7528\u8005\u7684\u8EAB\u4EFD\u53D6\u5F97\u6A5F\u654F\u8CC7\u6599\uFF0C\u9019\u5C31\u662F\u6240\u8B02\u7684 ",(0,s.jsx)(n.strong,{children:"CSRF(Cross-Site Request Forgery)"}),"\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u800C\u5F9E ",(0,s.jsx)(n.a,{href:"https://reqbin.com/code/javascript/lcpj87js/javascript-fetch-with-credentials",children:"Sending Credentials with the Fetch API"})," \u53EF\u4EE5\u5F97\u77E5\uFF0Cfetch \u9810\u8A2D\u662F\u4E0D\u6703\u5E36\u4E0A cookie \u7684\uFF0C\u9664\u975E\u52A0\u4E0A"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'fetch(url, {\n  credentials: "include",\n});\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u800C\u5982\u679C\u52A0\u4E0A ",(0,s.jsx)(n.code,{children:"credentials: 'include'"}),"\uFF0C\u4F3A\u670D\u5668\u5C31\u5FC5\u9808\u8981\u6709 ",(0,s.jsx)(n.code,{children:"Access-Control-Allow-Credentials: true"}),"\uFF0C\u9019\u6A23\u624D\u80FD\u5E36\u4E0A cookie\uFF0C\u800C\u5982\u679C\u4F3A\u670D\u5668\u52A0\u4E0A true \u5247\u6703\u6709\u4E00\u4E9B\u9650\u5236\uFF0C\u4F8B\u5982\u4E0D\u80FD\u4F7F\u7528 ",(0,s.jsx)(n.code,{children:"*"})," \u4F86\u8A2D\u5B9A ",(0,s.jsx)(n.code,{children:"Access-Control-Allow-Origin"}),"\uFF0C\u53EA\u80FD\u8A2D\u5B9A\u70BA\u7279\u5B9A\u7684\u7DB2\u57DF\uFF0C\u800C\u5927\u90E8\u5206\u7684\u7DB2\u7AD9\u61C9\u8A72\u90FD\u6703\u8A2D\u5B9A\u7279\u5B9A\u7DB2\u57DF\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u6240\u4EE5\u901A\u5E38\u5728\u5229\u7528 cookie \u6642\uFF0C\u90FD\u6703\u4F7F\u7528\u50CF\u662F form\u3001iframe\u3001img \u7B49\u7B49\u7684\u65B9\u5F0F\u4F86\u50B3\u9001\uFF0C\u5C31\u53EF\u4EE5\u7E5E\u904E CORS \u7684\u554F\u984C\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<body>\n  <form\n    id="hackForm"\n    action="http://localhost:3000/getUser"\n    method="GET"\n    target="hiddenFrame"\n  >\n    <input type="hidden" name="amount" value="1000" />\n  </form>\n\n  <iframe name="hiddenFrame" style="display: none"></iframe>\n\n  <script>\n    window.onload = function () {\n      document.getElementById("hackForm").submit();\n    };\n  <\/script>\n</body>\n'})})]})}function x(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},4634:function(e,n,r){r.d(n,{Z:function(){return o}});var t=r(5893);r(7294);var s=r(6735);function o(e){let{children:n,fallback:r}=e;return(0,s.Z)()?(0,t.jsx)(t.Fragment,{children:n?.()}):r??null}},8239:function(e,n,r){r.d(n,{Ei:function(){return i},gO:function(){return c},nI:function(){return l}});var t=r(5893),s=r(4634),o=r(1195);r(7294);let i=e=>{let{src:n,width:r="100%",center:s=!1,style:o={}}=e,i={width:`min(100%,${r})`,display:s?"block":"inline-block",margin:s?"0 auto":"0",borderRadius:"5px",...o};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("img",{src:n,style:{...i}}),(0,t.jsx)("br",{}),(0,t.jsx)("br",{})]})},c=e=>{let{children:n,width:r="100%",center:i=!1,style:c={}}=e;return(0,t.jsx)(s.Z,{children:()=>{let{sm:e}=(0,o.Z)(),s={width:`min(100%,${r})`,margin:i?"0 auto":"0",display:"flex",flexDirection:e?"column":"row",gap:"10px",alignItems:"center",...c};return(0,t.jsx)("div",{style:{...s},children:n})}})},l=e=>{let{style:n,width:r="100%",src:s}=e,o={width:`min(100%,${r})`,flex:1,...n};return(0,t.jsx)("div",{style:{...o},children:(0,t.jsx)(i,{src:s})})}},1195:function(e,n,r){r.d(n,{Z:function(){return s}});var t=r(7294);let s=()=>{let[e,n]=(0,t.useState)({width:window.innerWidth,height:window.innerHeight}),[r,s]=(0,t.useState)(!1);return(0,t.useLayoutEffect)(()=>{let e=()=>{let{innerWidth:e,innerHeight:r}=window;n({width:e,height:r}),s(e<=635)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),{sm:r,windowSize:e}}},65:function(e,n,r){r.d(n,{Z:function(){return c},a:function(){return i}});var t=r(7294);let s={},o=t.createContext(s);function i(e){let n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);