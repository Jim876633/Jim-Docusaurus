"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["3313"],{9303:function(e,n,r){r.r(n),r.d(n,{metadata:()=>s,contentTitle:()=>h,default:()=>x,assets:()=>p,toc:()=>m,frontMatter:()=>a});var s=JSON.parse('{"id":"ithome2023/day16","title":"[Day 16] MSW \u4ECB\u7D39","description":"\u524D\u9762\u5169\u7BC7\u4ECB\u7D39\u4E86 API \u7684\u6E2C\u8A66\u65B9\u6CD5\uFF0C\u4E0D\u904E\u53EF\u4EE5\u767C\u73FE\u5728\u6E2C\u8A66\u4E0A\uFF0C\u6703\u9700\u8981\u81EA\u5DF1\u6A21\u64EC\u56DE\u50B3\u7684\u6E2C\u8A66\u8CC7\u6599\uFF0C\u5047\u8A2D\u524D\u7AEF\u5728\u958B\u767C\u6642\uFF0C\u9084\u6709\u53E6\u5916\u5EFA\u7ACB\u4E00\u500B mock server \u4F86\u9032\u884C\u958B\u767C\uFF0C\u5C31\u6703\u8B8A\u6210\u9700\u8981\u5EFA\u7ACB\u5169\u4EFD\u5047\u8CC7\u6599\uFF0C\u4E00\u500B\u662F\u7D66 mock server \u7528\u7684\uFF0C\u4E00\u500B\u662F\u7D66\u6E2C\u8A66\u7528\u7684\uFF0C\u9019\u6A23\u5C31\u6703\u975E\u5E38\u7684\u8017\u6642\uFF0C\u800C\u4E14\u4E00\u65E6\u8CC7\u6599\u6709\u8B8A\u52D5\uFF0C\u5C31\u9700\u8981\u540C\u6B65\u66F4\u65B0\u5169\u4EFD\u8CC7\u6599\uFF0C\u9019\u6A23\u5728\u7DAD\u8B77\u4E0A\u5C31\u6703\u65B9\u9577\u4E0D\u65B9\u4FBF\u3002","source":"@site/docs/ithome2023/day16.mdx","sourceDirName":"ithome2023","slug":"/ithome2023/day16","permalink":"/ithome2023/day16","draft":false,"unlisted":false,"tags":[{"inline":false,"label":"IT Home 2023","permalink":"/tags/ithome-2023","description":"IT Home \u9435\u4EBA\u8CFD 2023 \u5E74\u7CFB\u5217\u6587\u7AE0"}],"version":"current","lastUpdatedAt":1718173908000,"frontMatter":{"title":"[Day 16] MSW \u4ECB\u7D39","tags":["ithome2023"]},"sidebar":"tutorialSidebar","previous":{"title":"[Day 15] React + Jest API \u6E2C\u8A66 (AI)","permalink":"/ithome2023/day15"},"next":{"title":"[Day 17] React + Jest API (MSW) \u6E2C\u8A66","permalink":"/ithome2023/day17"}}'),t=r("5893"),i=r("65"),c=r("9366");let o=r.p+"assets/images/day16-1-bde0b96a9d27e0601fba8e146dc84cbc.jpeg",l=r.p+"assets/images/day16-2-00d3a5dbba42d896525ba643e2c86b4d.jpg",d=r.p+"assets/images/day16-3-d6a7c0891b91026e7d5ceb52f9ce7733.jpg",a={title:"[Day 16] MSW \u4ECB\u7D39",tags:["ithome2023"]},h=void 0,p={},m=[{value:"Mock Service Worker (MSW)",id:"mock-service-worker-msw",level:2},{value:"\u5B89\u88DD",id:"\u5B89\u88DD",level:2},{value:"\u5EFA\u7ACB\u5047\u8CC7\u6599",id:"\u5EFA\u7ACB\u5047\u8CC7\u6599",level:2},{value:"\u6514\u622A http \u8ACB\u6C42",id:"\u6514\u622A-http-\u8ACB\u6C42",level:2},{value:"Mock Server \u555F\u52D5\uFF01",id:"mock-server-\u555F\u52D5",level:2}];function j(e){let n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"\u524D\u9762\u5169\u7BC7\u4ECB\u7D39\u4E86 API \u7684\u6E2C\u8A66\u65B9\u6CD5\uFF0C\u4E0D\u904E\u53EF\u4EE5\u767C\u73FE\u5728\u6E2C\u8A66\u4E0A\uFF0C\u6703\u9700\u8981\u81EA\u5DF1\u6A21\u64EC\u56DE\u50B3\u7684\u6E2C\u8A66\u8CC7\u6599\uFF0C\u5047\u8A2D\u524D\u7AEF\u5728\u958B\u767C\u6642\uFF0C\u9084\u6709\u53E6\u5916\u5EFA\u7ACB\u4E00\u500B mock server \u4F86\u9032\u884C\u958B\u767C\uFF0C\u5C31\u6703\u8B8A\u6210\u9700\u8981\u5EFA\u7ACB\u5169\u4EFD\u5047\u8CC7\u6599\uFF0C\u4E00\u500B\u662F\u7D66 mock server \u7528\u7684\uFF0C\u4E00\u500B\u662F\u7D66\u6E2C\u8A66\u7528\u7684\uFF0C\u9019\u6A23\u5C31\u6703\u975E\u5E38\u7684\u8017\u6642\uFF0C\u800C\u4E14\u4E00\u65E6\u8CC7\u6599\u6709\u8B8A\u52D5\uFF0C\u5C31\u9700\u8981\u540C\u6B65\u66F4\u65B0\u5169\u4EFD\u8CC7\u6599\uFF0C\u9019\u6A23\u5728\u7DAD\u8B77\u4E0A\u5C31\u6703\u65B9\u9577\u4E0D\u65B9\u4FBF\u3002"}),"\n",(0,t.jsxs)(n.p,{children:["\u4ECA\u5929\u8981\u4ECB\u7D39\u7684 ",(0,t.jsx)(n.a,{href:"https://mswjs.io/",children:"MSW"})," \u5C31\u662F\u4E00\u500B\u53EF\u4EE5\u5E6B\u52A9\u6211\u5011\u5728\u958B\u767C\u6642\uFF0C\u540C\u6642\u53EF\u4EE5\u9032\u884C API \u6E2C\u8A66\u7684 mock server\uFF0C\u9019\u6A23\u5C31\u53EF\u4EE5\u7701\u53BB\u7DAD\u8B77\u5169\u4EFD\u8CC7\u6599\u7684\u9EBB\u7169\u3002"]}),"\n",(0,t.jsx)(n.h2,{id:"mock-service-worker-msw",children:"Mock Service Worker (MSW)"}),"\n",(0,t.jsx)(n.p,{children:"\u90A3 MSW \u662F\u4EC0\u9EBC\u5462\uFF1F\u5B98\u65B9\u7684\u4ECB\u7D39\u662F\u9019\u6A23\u7684\uFF1A"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Mock by intercepting requests on the network level. Seamlessly reuse the same mock definition for testing, development, and debugging."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u7C21\u55AE\u4F86\u8AAA\uFF0C\u5C31\u662F\u900F\u904E\u6514\u622A\u7DB2\u8DEF\u8ACB\u6C42\u7684\u65B9\u5F0F\uFF0C\u4F86\u56DE\u50B3\u6A21\u64EC\u7684\u5047\u8CC7\u6599\uFF0C\u53EF\u4EE5\u770B\u4E00\u4E0B\u5B98\u65B9\u7684\u5716\uFF1A"}),"\n",(0,t.jsx)(c.Ei,{src:o}),"\n",(0,t.jsx)(n.p,{children:"\u7576 MSW \u6514\u622A\u5230\u8ACB\u6C42\u6642\uFF0C\u6703\u53BB\u6AA2\u67E5\u662F\u5426\u6709\u7B26\u5408\u7684\u6A21\u64EC\u8CC7\u6599\uFF0C\u5982\u679C\u6709\u7684\u8A71\uFF0C\u5C31\u6703\u56DE\u50B3\u6A21\u64EC\u8CC7\u6599\uFF0C\u5982\u679C\u6C92\u6709\u7684\u8A71\uFF0C\u5C31\u6703\u7E7C\u7E8C\u767C\u9001\u8ACB\u6C42\u5230\u771F\u6B63\u7684 API\u3002"}),"\n",(0,t.jsx)(n.p,{children:"\u4F7F\u7528 MSW \u7684\u597D\u8655\u6709\uFF1A"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4F7F\u7528\u4E0A\u975E\u5E38\u7C21\u55AE\u597D\u4E0A\u624B"}),"\n",(0,t.jsx)(n.li,{children:"\u4E00\u4EFD\u6A21\u64EC\u8CC7\u6599\uFF0C\u53EF\u4EE5\u540C\u6642\u7528\u5728\u958B\u767C\u6642\u548C\u6E2C\u8A66\u6642\u3002"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"npm run start"})," \u53EF\u4EE5\u540C\u6642\u555F\u52D5 mock server \u548C\u524D\u7AEF\u5C08\u6848\uFF0C\u4E0D\u9700\u8981\u53E6\u5916\u958B\u555F\u4E00\u500B mock server\u3002"]}),"\n",(0,t.jsx)(n.li,{children:"\u6703\u5BE6\u969B\u7684\u767C\u51FA\u8ACB\u6C42\uFF0C\u53EF\u4EE5\u6E2C\u8A66 API \u662F\u5426\u6B63\u5E38\u904B\u4F5C\u3002"}),"\n",(0,t.jsx)(n.li,{children:"\u53EF\u4EE5\u628A Mock Service \u5EFA\u5728\u540C\u4E00\u500B\u5C08\u6848\u5E95\u4E0B\uFF08\u4E0D\u904E\u6709\u4E9B\u4EBA\u4E0D\u559C\u6B61\u9019\u6A23\uFF0C\u9019\u500B\u597D\u8655\u898B\u4EC1\u898B\u667A\uFF09\u3002"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u7576\u7136\u4ED6\u4E5F\u6709\u4E00\u4E9B\u7F3A\u9EDE\uFF0C\u50CF\u662F\uFF1A"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["API \u56DE\u50B3\u8CC7\u6599\u683C\u5F0F\u4E0D\u50CF ",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/package/json-server",children:"json-server"})," \u4E00\u6A23\u65B9\u4FBF\u64B0\u5BEB\u3002"]}),"\n",(0,t.jsx)(n.li,{children:"\u56E0\u70BA Mock \u8CC7\u6599\u5EFA\u7ACB\u5728\u5C08\u6848\u5E95\u4E0B\uFF0C\u6240\u4EE5\u6703\u589E\u52A0\u5C08\u6848\u7684\u5927\u5C0F\u3002"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u4E0D\u904E\u4EE5\u6E2C\u8A66\u4F86\u8AAA\uFF0CMSW \u9084\u662F\u975E\u5E38\u597D\u7528\u7684\uFF0C\u63A5\u4E0B\u4F86\u5C31\u4F86\u4ECB\u7D39\u4E00\u4E0B MSW \u7684\u4F7F\u7528\u65B9\u6CD5\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"\u5B89\u88DD",children:"\u5B89\u88DD"}),"\n",(0,t.jsxs)(n.p,{children:["MSW \u7684\u5B89\u88DD\u975E\u5E38\u7C21\u55AE\uFF0C\u9996\u5148\u5148\u5728\u5C08\u6848\u5E95\u4E0B\u5B89\u88DD ",(0,t.jsx)(n.code,{children:"msw"})," \u5957\u4EF6\uFF1A"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install msw --save-dev\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u5EFA\u7ACB\u5047\u8CC7\u6599",children:"\u5EFA\u7ACB\u5047\u8CC7\u6599"}),"\n",(0,t.jsxs)(n.p,{children:["\u5728 ",(0,t.jsx)(n.code,{children:"src"})," \u5E95\u4E0B\u5EFA\u7ACB\u4E00\u500B ",(0,t.jsx)(n.code,{children:"mocks"})," \u8CC7\u6599\u593E\uFF0C\u4E26\u5728\u88E1\u9762\u5EFA\u7ACB\u4E00\u500B ",(0,t.jsx)(n.code,{children:"handlers.js"})," \u6A94\u6848\uFF0C\u9019\u500B\u6A94\u6848\u5C31\u662F\u7528\u4F86\u64B0\u5BEB\u6A21\u64EC\u8CC7\u6599\u7684\u5730\u65B9\u3002"]}),"\n",(0,t.jsx)(n.p,{children:"\u5BEB\u6CD5\u6703\u50CF\u9019\u6A23\uFF1A"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'// src/mocks/handlers.js\nimport { rest } from "msw";\n\nconst fetchUserUrl = "https://jsonplaceholder.typicode.com/users";\n\nexport const handlers = [\n  rest.get(fetchUserUrl, (req, res, ctx) => {\n    return res(\n      ctx.status(200),\n      ctx.json([\n        {\n          id: 1,\n          name: "John Doe",\n          username: "johndoe",\n          email: "john.doe@example.com",\n        },\n      ])\n    );\n  }),\n];\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u9019\u908A\u6211\u5011\u6A21\u64EC\u4E86\u4E00\u500B ",(0,t.jsx)(n.code,{children:"GET"})," \u7684\u8ACB\u6C42\uFF0C\u7576\u8ACB\u6C42\u5230 ",(0,t.jsx)(n.code,{children:"https://jsonplaceholder.typicode.com/users"})," \u6642\uFF0C\u5C31\u6703\u56DE\u50B3\u4E00\u500B\u5047\u7684\u4F7F\u7528\u8005\u8CC7\u6599\u3002"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.em,{children:["\uFF0A\u9019\u908A\u4E5F\u53EF\u4EE5\u4F7F\u7528 ",(0,t.jsx)(n.a,{href:"https://fakerjs.dev/",children:"fakerjs"})," \u4F86\u7522\u751F\u5047\u8CC7\u6599\uFF0C\u6703\u65B9\u4FBF\u5F88\u591A\uFF01"]})}),"\n",(0,t.jsx)(n.h2,{id:"\u6514\u622A-http-\u8ACB\u6C42",children:"\u6514\u622A http \u8ACB\u6C42"}),"\n",(0,t.jsx)(n.p,{children:"\u8981\u5728\u958B\u767C\u6642\u958B\u555F Mock Server \u9700\u8981\u5148\u5BEB\u6514\u622A http request \u7684\u7A0B\u5F0F\u78BC\uFF0C\u4E0D\u904E\u9019\u908A\u6211\u5011\u4E0D\u9700\u8981\u81EA\u5DF1\u5BEB\uFF0CMSW \u975E\u5E38\u597D\u5FC3\u7684\u5E6B\u6211\u5011\u5BEB\u597D\u4E86\uFF0C\u53EA\u8981\u4E0B\u6307\u4EE4\uFF1A"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npx msw init <PUBLIC_DIR> --save\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"PUBLIC_DIR"})," \u662F\u6307\u524D\u7AEF\u5C08\u6848\u7684 ",(0,t.jsx)(n.code,{children:"public"})," \u8CC7\u6599\u593E\uFF0C",(0,t.jsx)(n.a,{href:"https://mswjs.io/docs/getting-started/integrate/browser#where-is-my-public-directory",children:"\u5B98\u7DB2"}),"\u4E5F\u6709\u6574\u7406\u4E86\u5404\u500B\u6846\u67B6\u7684\u6839\u76EE\u9304\u8CC7\u8A0A\u3002"]}),"\n",(0,t.jsx)(n.p,{children:"\u90A3\u9019\u908A\u6211\u662F\u4F7F\u7528 Vite\uFF0C\u6240\u4EE5\u6211\u5011\u53EF\u4EE5\u4E0B\uFF1A"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npx msw init ./public --save\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u9019\u6642\u5019\u5C31\u6703\u5728 ",(0,t.jsx)(n.code,{children:"public"})," \u8CC7\u6599\u593E\u4E0B\u5EFA\u7ACB\u4E00\u500B ",(0,t.jsx)(n.code,{children:"mockServiceWorker.js"})," \u6A94\u6848\uFF0C\u88CF\u9762\u5C31\u6709\u6514\u622A http request \u7684\u7A0B\u5F0F\u78BC\u4E86\u3002"]}),"\n",(0,t.jsx)(n.h2,{id:"mock-server-\u555F\u52D5",children:"Mock Server \u555F\u52D5\uFF01"}),"\n",(0,t.jsxs)(n.p,{children:["\u6709\u4E86\u6514\u622A\u5668\u5F8C\uFF0C\u5C31\u8981\u4F86\u958B\u555F Mock Server \u4E86\uFF0C\u5728 ",(0,t.jsx)(n.code,{children:"Mock"})," \u7684\u8CC7\u6599\u593E\u4E0B\u5EFA\u7ACB\u4E00\u500B ",(0,t.jsx)(n.code,{children:"browser.js"})," \u6A94\u6848\uFF0C\u5728\u88E1\u9762\u9032\u884C worker \u7684\u8A2D\u5B9A\uFF1A"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'// src/mocks/browser.js\nimport { setupWorker } from "msw";\nimport { handlers } from "./handlers";\n\nexport const worker = setupWorker(...handlers);\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u63A5\u8457\u5728 ",(0,t.jsx)(n.code,{children:"main.jsx"})," \u4E2D\u5F15\u5165 ",(0,t.jsx)(n.code,{children:"browser.js"}),"\uFF0C\u9019\u908A\u8A2D\u5B9A\u53EA\u5728\u958B\u767C\u6A21\u5F0F\u4E0B\u555F\u52D5 Mock Server\uFF1A"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'import React from "react";\nimport ReactDOM from "react-dom/client";\nimport App from "./App.jsx";\nimport "./index.css";\nimport { worker } from "./mocks/browser.js";\n\nif (process.env.NODE_ENV === "development") {\n  worker.start();\n}\n\nReactDOM.createRoot(document.getElementById("root")!).render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u63A5\u8457\u53EA\u8981\u555F\u52D5\u5C08\u6848\uFF0C\u5C31\u53EF\u4EE5\u770B\u5230 Mock Server \u5DF2\u7D93\u555F\u52D5\u4E86\uFF01"}),"\n",(0,t.jsx)(c.Ei,{src:l}),"\n",(0,t.jsxs)(n.p,{children:["\u7576\u770B\u5230 ",(0,t.jsx)("strong",{style:{color:"red"},children:"[MSW] Mocking enabled."})," \u5C31\u4EE3\u8868\u5DF2\u7D93\u555F\u52D5\u4E86\uFF0C\u5982\u679C MSW \u767C\u73FE\u6C92\u6709\u7B26\u5408\u7684\u6A21\u64EC\u8CC7\u6599\uFF0C\u4E5F\u6703\u5F88\u597D\u5FC3\u7684\u986F\u793A warning \u63D0\u9192\u4F60\u3002"]}),"\n",(0,t.jsx)(n.p,{children:"\u90A3\u9019\u908A\u6211\u5EFA\u7ACB\u7684\u6A21\u64EC\u8CC7\u6599\uFF0C\u5C31\u6709\u88AB MSW \u6240\u6514\u622A\u5230\uFF0C\u53EF\u4EE5\u5728 console \u5F88\u6E05\u695A\u7684\u770B\u5230\u56DE\u50B3\u7684\u8CC7\u6599"}),"\n",(0,t.jsx)(c.Ei,{src:d}),"\n",(0,t.jsx)(n.p,{children:"\u662F\u4E0D\u662F\u8D85\u7D1A\u65B9\u4FBF\u7684\u554A\uFF5E\u5927\u5BB6\u53EF\u4EE5\u73A9\u770B\u770B\uFF0C\u4E0B\u4E00\u7BC7\u4F86\u4ECB\u7D39 MSW \u7684\u6E2C\u8A66\u65B9\u6CD5\u3002"})]})}function x(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(j,{...e})}):j(e)}},144:function(e,n,r){r.d(n,{Z:function(){return i}});var s=r(5893);r(7294);var t=r(7227);function i(e){let{children:n,fallback:r}=e;return(0,t.Z)()?(0,s.jsx)(s.Fragment,{children:n?.()}):r??null}},9366:function(e,n,r){r.d(n,{Ei:function(){return c},gO:function(){return o},nI:function(){return l}});var s=r(5893),t=r(144),i=r(1094);r(7294);let c=e=>{let{src:n,width:r="100%",center:t=!1,style:i={}}=e,c={width:`min(100%,${r})`,display:t?"block":"inline-block",margin:t?"0 auto":"0",borderRadius:"5px",...i};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{src:n,style:{...c}}),(0,s.jsx)("br",{}),(0,s.jsx)("br",{})]})},o=e=>{let{children:n,width:r="100%",center:c=!1,style:o={}}=e;return(0,s.jsx)(t.Z,{children:()=>{let{sm:e}=(0,i.Z)(),t={width:`min(100%,${r})`,margin:c?"0 auto":"0",display:"flex",flexDirection:e?"column":"row",gap:"10px",alignItems:"center",...o};return(0,s.jsx)("div",{style:{...t},children:n})}})},l=e=>{let{style:n,width:r="100%",src:t}=e,i={width:`min(100%,${r})`,flex:1,...n};return(0,s.jsx)("div",{style:{...i},children:(0,s.jsx)(c,{src:t})})}},1094:function(e,n,r){r.d(n,{Z:function(){return i}});var s=r(7294);let t=635,i=()=>{let[e,n]=(0,s.useState)({width:window.innerWidth,height:window.innerHeight}),[r,i]=(0,s.useState)(!1);return(0,s.useLayoutEffect)(()=>{let e=()=>{let{innerWidth:e,innerHeight:r}=window;n({width:e,height:r}),i(e<=t)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),{sm:r,windowSize:e}}},65:function(e,n,r){r.d(n,{Z:function(){return o},a:function(){return c}});var s=r(7294);let t={},i=s.createContext(t);function c(e){let n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);