---
title: "[Day 05] React æ¸¬è©¦å®‰è£ä»‹ç´¹ ( CRA / Vite / Next.js )"
tags: [ithome2023]
---

å‰å¹¾ç¯‡ä»‹ç´¹å®Œ JavaScript çš„æ¸¬è©¦æ¡†æ¶ï¼Œä»Šå¤©è¦ä¾†ä»‹ç´¹ React æ¸¬è©¦å®‰è£ã€‚æˆ‘æœƒä»¥ç›®å‰æœ€å¸¸ç”¨çš„ React é–‹ç™¼å·¥å…· [CRA](https://create-react-app.dev/)ã€[Vite](https://vitejs.dev/) åŠ [Next.js](https://nextjs.org/) ä¾†ä»‹ç´¹ã€‚

## React æ¸¬è©¦å¥—ä»¶

React æ¸¬è©¦å¥—ä»¶æœ‰å¾ˆå¤šç¨®ï¼Œåƒæ˜¯ [Enzyme](https://enzymejs.github.io/enzyme/)ã€[Testing Library](https://testing-library.com/)ã€[React Hooks Testing Library](https://react-hooks-testing-library.com/) ç­‰ç­‰ï¼Œé€™é‚Šæˆ‘ä½¿ç”¨ React å®˜æ–¹æ¨è–¦çš„ Testing Libraryã€‚

## React é–‹ç™¼å·¥å…·

### ğŸ“Œ CRA

é›–ç„¶åœ¨æ–°çš„[å®˜ç¶²æ¨è–¦](https://react.dev/learn/start-a-new-react-project#nextjs)ä¸­ï¼Œå·²ç¶“æŠŠ CRA æ‹¿æ‰ï¼Œä¸éä¸€äº›èˆŠå°ˆæ¡ˆå¯èƒ½é‚„æ˜¯æœƒä½¿ç”¨ CRA ä¾†é–‹ç™¼ã€‚

å®‰è£ï¼š

```bash
npx create-react-app my-app
```

CRA æœ‰å€‹å¾ˆå¤§å„ªé»å°±æ˜¯å…§å»ºå°±æœ‰å« Jest åŠå¸¸ç”¨çš„ React-testing-libraryï¼Œæ‰€ä»¥ä¸ç”¨å†é¡å¤–å®‰è£ã€‚

å¦‚æœè¦ä½¿ç”¨ TypeScript çš„è©±ï¼Œå¯ä»¥åœ¨å®‰è£æ™‚åŠ ä¸Š `--template typescript`ã€‚

```bash
npx create-react-app my-app --template typescript
```

å°±æœƒæŠŠ TypeScript éœ€è¦çš„æ¸¬è©¦å¥—ä»¶éƒ½å®‰è£é€²å»ã€‚

### ğŸ“Œ Vite

Vite æ˜¯ 2021 æ¨å‡ºçš„é–‹ç™¼å·¥å…·ï¼Œå®ƒçš„ç‰¹è‰²æ˜¯å¿«é€Ÿçš„é–‹ç™¼é€Ÿåº¦ï¼Œå®˜æ–¹æ¨è–¦çš„æ¸¬è©¦æ¡†æ¶æ˜¯ Vitestï¼ŒVitest çš„å®‰è£æ–¹å¼å¯ä»¥åƒè€ƒ[å®˜æ–¹æ–‡ä»¶](https://vitejs.dev/guide/features.html#testing)ã€‚é€™é‚Šæˆ‘å°±é‚„æ˜¯ä»¥å®‰è£ Jest ç‚ºä¾‹ã€‚

å®‰è£ Viteï¼š

```bash
npm create vite@latest
```

#### JavaScript

å®‰è£ Jest åŠ React-testing-libraryï¼š

```bash
npm i -D  jest @testing-library/react @testing-library/jest-dom @testing-library/user-event
```

åœ¨ package.json åŠ å…¥ script

```json
{
  "scripts": {
    "test": "jest"
  }
}
```

å‰é¢æœ‰æåˆ°å› ç‚ºå¦‚æœè¦ä½¿ç”¨ ESModule çš„ import/export èªæ³•ï¼Œéœ€è¦é¡å¤–å®‰è£ [@babel/preset-env](https://www.npmjs.com/package/@babel/preset-env) åŠ [babel-jest](https://www.npmjs.com/package/babel-jest)ï¼Œè©³ç´°å¯åƒè€ƒ[å®˜æ–¹æ–‡ä»¶](https://jestjs.io/docs/ecmascript-modules)ã€‚

```bash
npm install -D @babel/preset-env babel-jest
```

è€Œåœ¨ React å°ˆæ¡ˆé‚„éœ€è¦å®‰è£ [@babel/preset-react](https://www.npmjs.com/package/@babel/preset-react)

```bash
npm install -D @babel/preset-react
```

å®‰è£å®Œå¾Œï¼Œå»ºç«‹ babel.config.json æˆ– .babelrcï¼Œä¸¦æŠŠå®‰è£å®Œçš„å¥—ä»¶åŠ åˆ° presetsï¼Œåœ¨ React 17 ä¹‹å¾Œçš„è¨˜å¾—è¦åŠ ä¸Š runtimeã€‚

```json
{
  "presets": [
    "@babel/preset-env",
    ["@babel/preset-react", { "runtime": "automatic" }]
  ]
}
```

åœ¨ React è¦æ”¯æ´ svg åŠ css ç­‰æ ¼å¼çš„æª”æ¡ˆï¼Œæœƒè¢«ç•¶ä½œ js æª”ç·¨è­¯ï¼Œæ‰€ä»¥éœ€è¦é¡å¤–å®‰è£ [jest-svg-transformer](https://www.npmjs.com/package/jest-svg-transformer) åŠ [identity-obj-proxy](https://www.npmjs.com/package/identity-obj-proxy)ã€‚

```bash
npm i -D jest-svg-transformer identity-obj-proxy
```

ä¸¦åœ¨ package.json ä¸­åŠ å…¥ä»¥ä¸‹è¨­å®šï¼š

```json
{
  "jest": {
    "transform": {
      "^.+\\.(js|jsx|ts|tsx)$": "babel-jest"
    },
    "moduleNameMapper": {
      "\\.(svg)$": "jest-svg-transformer",
      "\\.(css|less|scss|sass)$": "identity-obj-proxy"
    }
  }
}
```

å†ä¾†éœ€è¦å®‰è£ [jest-environment-jsdom](https://www.npmjs.com/package/jest-environment-jsdom) è®“ Jest åœ¨æ¸¬è©¦æ™‚ä½¿ç”¨ jsdom ä¾†æ¨¡æ“¬ç€è¦½å™¨ç’°å¢ƒï¼Œé€™æ¨£å°±å¯ä»¥åœ¨æ¸¬è©¦æ™‚ä½¿ç”¨ DOM APIã€‚

```bash
npm i -D jest-environment-jsdom
```

æœ€å¾Œå¦‚æœè¦ä½¿ç”¨ @testing-library/jest-dom çš„æ“´å……èªæ³•ï¼Œéœ€è¦å…ˆå»ºç«‹ä¸€å€‹ setupTests.js æª”æ¡ˆï¼Œä¸¦åœ¨è£¡é¢åŠ å…¥ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š

```js
import "@testing-library/jest-dom";
```

æ¥è‘—åœ¨ package.json ä¸­åŠ å…¥ä»¥ä¸‹è¨­å®šï¼š

```json
{
  "jest": {
    "setupFilesAfterEnv": ["<rootDir>/setupTests.js"]
  }
}
```

å°±å¯ä»¥åœ¨ Vite è·‘ React æ¸¬è©¦äº†ï¼ï¼

**ï¼ŠESLint è¨­å®š**

å¦‚æœä½¿ç”¨ Vite å…§å»ºçš„ ESLint æ¸¬è©¦æª”æ¡ˆæœƒä¸€ç›´å ±ç´…å­—ï¼Œä¸éæ˜¯å¯ä»¥è·‘æ¸¬è©¦çš„ï¼Œåªæ˜¯çœ‹èµ·ä¾†å¾ˆä¸èˆ’æœï¼Œè§£æ±ºæ–¹å¼æ˜¯åœ¨ .eslintrc.js ä¸­é–‹å•Ÿ jest ç’°å¢ƒï¼š

```js
module.exports = {
  env: {
    jest: true,
  },
};
```

#### TypeScript

ä½¿ç”¨ TypeScript çš„è©±ï¼Œæ­¥é©Ÿéƒ½èˆ‡ JavaScript æµç¨‹ç›¸åŒï¼Œåªæ˜¯éœ€è¦é¡å¤–å®‰è£ [@types/jest](https://www.npmjs.com/package/@types/jest) è·Ÿ [@babel/preset-typescript](https://www.npmjs.com/package/@babel/preset-typescript)ã€‚

```bash
npm i -D @types/jest @babel/preset-typescript
```

åœ¨ .babel.config.json è£¡åŠ å…¥ typeScript è¨­å®š

```json
{
  "presets": [
    "@babel/preset-env",
    ["@babel/preset-react", { "runtime": "automatic" }],
    "@babel/preset-typescript"
  ]
}
```

ç„¶å¾Œä½¿ç”¨ @testing-library/jest-dom çš„æ“´å……èªæ³•ï¼Œéœ€è¦æŠŠ setupTests.js æ”¹æˆ setupTests.tsï¼Œç„¶å¾Œåœ¨ tsconfig.json ä¸­å¼•å…¥ï¼š

```json
{
  "compilerOptions": {
    ..., // å…¶ä»–è¨­å®š
    "include": ["src/setupTests.ts"]
  }
}
```

é€™æ¨£å°±å¯ä»¥è·‘ TypeScript çš„æ¸¬è©¦äº†ï¼

### ğŸ“Œ Next.js

#### JavaScript

```bash
npx create-next-app@latest
```

å®‰è£ Jestã€React-testing-library åŠ jest-environment-jsdomï¼š

```bash
npm i -D  jest @testing-library/react @testing-library/jest-dom @testing-library/user-event jest-environment-jsdom
```

åœ¨ package.json åŠ å…¥ script

```json
{
  "scripts": {
    "test": "jest"
  },
  "jest": {
    "testEnvironment": "jsdom",
    "setupFilesAfterEnv": ["<rootDir>/setupTests.js"]
  }
}
```

å»ºç«‹ setupTests.js

```js
import "@testing-library/jest-dom";
```

å¦‚æœé‡åˆ° _Parsing error : Cannot find module 'next/babel'_ éœ€è¦åœ¨ .eslintrc.js ä¸­åŠ å…¥ `next/babel`

```js
{
  "extends": ["next/babel", "next/core-web-vitals"]
}
```

å¦å¤–åœ¨ next.js ä¸ç”¨å®‰è£ babelï¼Œåªè¦åœ¨ .babelrc ä¸­åŠ å…¥ `next/babel` å°±å¯ä»¥äº†ã€‚

```json
{
  "presets": ["next/babel"]
}
```

#### TypeScript

åªè¦é¡å¤–å®‰è£ [@types/jest](https://www.npmjs.com/package/@types/jest)ã€‚

```bash
npm i -D @types/jest
```

Next.js Jest è¨­å®šä¹Ÿå¯ä»¥åƒè€ƒ [Setting up Jest (with the Rust Compiler)](https://nextjs.org/docs/pages/building-your-application/optimizing/testing#setting-up-jest-with-the-rust-compiler)

---

ä»Šå¤©çš„ç¨‹å¼ç¢¼éƒ½æ”¾æœ‰åœ¨ [GitHub](https://github.com/Jim876633/ithome-2023/tree/main/day5)ï¼Œæœ‰èˆˆè¶£çš„å¯ä»¥ä¸‹è¼‰ä¾†ç©ï¼Œä¸‹ä¸€ç¯‡ä¾†ä»‹ç´¹ React Testing Library çš„èªæ³•ï½

## åƒè€ƒè³‡æ–™

- [How to setup Jest and React Testing Library in Vite project](https://zaferayan.medium.com/how-to-setup-jest-and-react-testing-library-in-vite-project-2600f2d04bdd)
- [jest-dom with TypeScript](https://github.com/testing-library/jest-dom#with-typescript)
- [Parsing error : Cannot find module 'next/babel'](https://stackoverflow.com/questions/68163385/parsing-error-cannot-find-module-next-babel)
