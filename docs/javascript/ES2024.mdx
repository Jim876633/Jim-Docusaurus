---
title: ã€JavaScriptã€‘ECMAScript 2024 æ–°åŠŸèƒ½ä»‹ç´¹
sidebar_label: ECMAScript 2024
tags: [javascript]
---

import { Img } from "@site/src/components/Width.jsx";

å¾ ES6 ( 2015 ) ä¹‹å¾Œï¼Œæ¯å¹´éƒ½æœƒæ¨å‡ºä¸€ç‰ˆæ–°çš„ ECMAScriptï¼Œä»Šå¹´æ¨å‡ºäº† ECMAScript 2024 ( ES15 )ï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹ä»Šå¹´æœ‰ä»€éº¼æ–°åŠŸèƒ½ï¼

## è¦æ€éº¼çœ‹ï¼Ÿ

**ECMAScript** æ˜¯ç”± Ecma International å®šç¾©çš„èªè¨€è¦ç¯„ï¼Œç·¨è™Ÿæ˜¯ ECMA-262ï¼Œé™¤äº† ECMAScript ä»¥å¤–ï¼Œé‚„æœ‰åƒæ˜¯ ECMA-404(JSON)ã€ECMA-334(C#)ç­‰è¦ç¯„ã€‚

è€Œåˆ¶å®š ECMA æ¨™æº–çš„æŠ€è¡“å§”å“¡ï¼Œåˆç¨± TC(Technical Committee)ï¼Œå…¶ä¸­ [TC39](https://github.com/tc39) å°±æ˜¯è² è²¬ç®¡ç†åŠåˆ¶å®š ECMAScript(ECMA-262)ã€‚

æ¯å¹´çš„æ–°åŠŸèƒ½éƒ½æœƒæœ‰å››å€‹éšæ®µçš„[ææ¡ˆ](https://github.com/tc39/proposals)ï¼Œæ­£å¼åŠ å…¥ ECMAScript è¦ç¯„çš„æœƒæ˜¯åœ¨ [finished-proposals](https://github.com/tc39/proposals/blob/main/finished-proposals.md)è£¡ï¼Œå¯ä»¥çœ‹åˆ°æ¯å¹´æ–°å¢çš„åŠŸèƒ½æœ‰ä»€éº¼ï¼Œä»¥åŠææ¡ˆäººè·Ÿå¯©æ ¸çš„ meeting æ–‡æª”ã€‚

## ECMAScript 2024

ä»Šå¹´ç¸½å…±æœ‰ä¸ƒå€‹æ–°åŠŸèƒ½ï¼š

- [ArrayBuffer transfer](https://github.com/tc39/proposal-arraybuffer-transfer)
- [Promise.withResolvers](https://github.com/tc39/proposal-promise-with-resolvers)
- [Array Grouping](https://github.com/tc39/proposal-array-grouping)
- [Resizable and growable ArrayBuffers](https://github.com/tc39/proposal-resizable-arraybuffer)
- [RegExp v flag with set notation + properties of strings](https://github.com/tc39/proposal-regexp-v-flag)
- [Atomics.waitAsync](https://github.com/tc39/proposal-atomics-wait-async)
- [Well-Formed Unicode Strings](https://github.com/tc39/proposal-is-usv-string)

### ArrayBuffer transfer [æ”¯æ´åº¦](https://caniuse.com/mdn-javascript_builtins_arraybuffer_transfer)

æ–°å¢äº† `ArrayBuffer.prototype.transfer()` å’Œ `ArrayBuffer.prototype.transferToFixedLength()` æ–¹æ³•ï¼Œå¯ä»¥å°‡ä¸€å€‹ ArrayBuffer çš„å…§å®¹è½‰ç§»åˆ°æ–°çš„ ArrayBufferï¼ŒåŒæ™‚è®“åŸä¾†çš„ ArrayBuffer è®Šæˆä¸å¯ç”¨ç‹€æ…‹ã€‚

```javascript
// å‰µå»ºä¸€å€‹ ArrayBuffer
const buffer = new ArrayBuffer(8);
const view = new Uint8Array(buffer);
view[0] = 42;

console.log(buffer.byteLength); // 8
console.log(view[0]); // 42

// è½‰ç§»åˆ°æ–°çš„ ArrayBufferï¼Œå¯ä»¥æŒ‡å®šæ–°çš„å¤§å°
const newBuffer = buffer.transfer(16);
const newView = new Uint8Array(newBuffer);

console.log(newBuffer.byteLength); // 16
console.log(newView[0]); // 42

// åŸä¾†çš„ buffer å·²ç¶“è¢« detached
console.log(buffer.byteLength); // 0
```

### Promise.withResolvers [æ”¯æ´åº¦](https://caniuse.com/mdn-javascript_builtins_promise_withresolvers)

æ–°å¢äº† `Promise.withResolvers()`ï¼Œå›å‚³ä¸€å€‹åŒ…å« promiseã€resolveã€reject çš„ç‰©ä»¶ï¼Œè®“æˆ‘å€‘å¯ä»¥åœ¨ Promise å¤–éƒ¨æ§åˆ¶å®ƒçš„ç‹€æ…‹ã€‚

```javascript
// ä»¥å‰éœ€è¦é€™æ¨£å¯«
let resolve, reject;
const promise = new Promise((res, rej) => {
  resolve = res;
  reject = rej;
});

// ç¾åœ¨å¯ä»¥é€™æ¨£å¯«
const { promise, resolve, reject } = Promise.withResolvers();

// åœ¨æŸå€‹åœ°æ–¹ resolve
setTimeout(() => {
  resolve("Hello World!");
}, 1000);

promise.then(console.log); // Hello World!
```

é€™å€‹æ–¹æ³•åœ¨å¤–éƒ¨æ§åˆ¶ Promise ç‹€æ…‹æ™‚å¾ˆæœ‰ç”¨ï½

### Array Grouping [æ”¯æ´åº¦](https://caniuse.com/mdn-javascript_builtins_object_groupby)

æ–°å¢äº† `Object.groupBy()` å’Œ `Map.groupBy()` å…©å€‹æ–¹æ³•ï¼Œå¯ä»¥æ ¹æ“šå›å‚³çš„å‡½å¼çµæœä¾†åˆ†çµ„é™£åˆ—å…ƒç´ ã€‚

```javascript
const inventory = [
  { name: "asparagus", type: "vegetables" },
  { name: "bananas", type: "fruit" },
  { name: "goat", type: "meat" },
  { name: "cherries", type: "fruit" },
  { name: "fish", type: "meat" },
];

// Object.groupBy - å›å‚³ä¸€èˆ¬ç‰©ä»¶
const result = Object.groupBy(inventory, ({ type }) => type);
console.log(result);
// {
//   vegetables: [{ name: 'asparagus', type: 'vegetables' }],
//   fruit: [
//     { name: 'bananas', type: 'fruit' },
//     { name: 'cherries', type: 'fruit' }
//   ],
//   meat: [
//     { name: 'goat', type: 'meat' },
//     { name: 'fish', type: 'meat' }
//   ]
// }

// Map.groupBy - å›å‚³ Map
const mapResult = Map.groupBy(inventory, ({ type }) => type);
console.log(mapResult.get("fruit"));
// [{ name: 'bananas', type: 'fruit' }, { name: 'cherries', type: 'fruit' }]
```

### Resizable and growable ArrayBuffers [æ”¯æ´åº¦](https://caniuse.com/mdn-javascript_builtins_arraybuffer_resize)

ArrayBuffer å’Œ SharedArrayBuffer ç¾åœ¨æ”¯æ´å‹•æ…‹èª¿æ•´å¤§å°ã€‚

```javascript
// å»ºç«‹å¯èª¿æ•´å¤§å°çš„ ArrayBufferï¼Œæœ€å¤§å¤§å°ç‚º 1024 bytes
const buffer = new ArrayBuffer(8, { maxByteLength: 1024 });
console.log(buffer.byteLength); // 8
console.log(buffer.maxByteLength); // 1024

// èª¿æ•´å¤§å°
buffer.resize(16);
console.log(buffer.byteLength); // 16

// SharedArrayBuffer ä¹Ÿæ”¯æ´ grow æ–¹æ³•
const sharedBuffer = new SharedArrayBuffer(8, { maxByteLength: 1024 });
sharedBuffer.grow(16);
console.log(sharedBuffer.byteLength); // 16
```

### RegExp v flag [æ”¯æ´åº¦](https://caniuse.com/mdn-javascript_builtins_regexp_unicodesets)

æ–°å¢äº† RegExp çš„ `v` flagï¼Œè®“æ­£è¦è¡¨é”å¼æ”¯æ´æ›´å¼·å¤§çš„å­—å…ƒé›†åˆé‹ç®—ï¼Œå¯ä»¥åšäº¤é›†ï¼ˆ&&ï¼‰ã€å·®é›†ï¼ˆ--ï¼‰ç­‰æ“ä½œã€‚

```javascript
// 1. äº¤é›†é‹ç®—ï¼ˆ&&ï¼‰- åŒæ™‚ç¬¦åˆå…©å€‹æ¢ä»¶
// æ‰¾å‡ºã€Œæ—¢æ˜¯æ•¸å­—åˆæ˜¯ 0-5 ç¯„åœå…§ã€çš„å­—å…ƒ
const numberAndRange = /[\d&&[0-5]]/v;
console.log(numberAndRange.test("3")); // true (æ—¢æ˜¯æ•¸å­—åˆåœ¨0-5ç¯„åœå…§)
console.log(numberAndRange.test("7")); // false (æ˜¯æ•¸å­—ä½†ä¸åœ¨0-5ç¯„åœå…§)
console.log(numberAndRange.test("a")); // false (ä¸æ˜¯æ•¸å­—)

// 2. å·®é›†é‹ç®—ï¼ˆ--ï¼‰- æ’é™¤ç‰¹å®šå­—å…ƒ
// æ‰¾å‡ºã€Œè‹±æ–‡å­—æ¯ä½†æ’é™¤å…ƒéŸ³ã€çš„å­—å…ƒ
const consonants = /[[a-z]--[aeiou]]/v;
console.log(consonants.test("b")); // true (å­éŸ³)
console.log(consonants.test("a")); // false (æ¯éŸ³è¢«æ’é™¤)

// 3. å¯¦éš›æ‡‰ç”¨ï¼šé©—è­‰ç‰¹æ®Šæ ¼å¼
// åªå…è¨±æ•¸å­—å’Œéƒ¨åˆ†ç¬¦è™Ÿï¼Œä½†æ’é™¤æ‹¬è™Ÿ
const specialFormat = /[[\d\-_.]--[()]]/v;
console.log(specialFormat.test("1")); // true
console.log(specialFormat.test("-")); // true
console.log(specialFormat.test("(")); // false (æ‹¬è™Ÿè¢«æ’é™¤)
```

### Atomics.waitAsync [æ”¯æ´åº¦](https://caniuse.com/mdn-javascript_builtins_atomics_waitasync)

æ–°å¢äº† `Atomics.waitAsync()` æ–¹æ³•ï¼Œæä¾›éåŒæ­¥çš„æ–¹å¼ç­‰å¾… SharedArrayBuffer ä¸­çš„å€¼æ”¹è®Šã€‚

åœ¨å‰ç«¯çš„å¯¦éš›æ‡‰ç”¨å ´æ™¯ï¼š

```javascript
// ä¸»åŸ·è¡Œç·’å»ºç«‹å…±äº«è¨˜æ†¶é«”ä¾†è¿½è¹¤è™•ç†ç‹€æ…‹
const sharedBuffer = new SharedArrayBuffer(4);
const statusArray = new Int32Array(sharedBuffer);
Atomics.store(statusArray, 0, 0); // 0 = æœªé–‹å§‹, 1 = è™•ç†ä¸­, 2 = å®Œæˆ

// ä¸»åŸ·è¡Œç·’ï¼šç­‰å¾… Worker å®Œæˆåœ–ç‰‡è™•ç†
const { async, value } = Atomics.waitAsync(statusArray, 0, 0);

if (async) {
  value.then(() => {
    const status = Atomics.load(statusArray, 0);
    if (status === 2) {
      console.log("æ‰€æœ‰åœ–ç‰‡è™•ç†å®Œæˆï¼å¯ä»¥ä¸‹è¼‰äº†");
      document.getElementById("download-btn").disabled = false;
    }
  });
}

// å»ºç«‹ Worker ä¾†è™•ç†åœ–ç‰‡
const worker = new Worker("image-processor.js");
worker.postMessage({ sharedBuffer, imageFiles });
```

```javascript
// image-processor.js (Web Worker)
self.onmessage = function (e) {
  const { sharedBuffer, imageFiles } = e.data;
  const statusArray = new Int32Array(sharedBuffer);

  // è¨­å®šç‹€æ…‹ç‚ºè™•ç†ä¸­
  Atomics.store(statusArray, 0, 1);

  // è™•ç†åœ–ç‰‡...
  processImages(imageFiles).then(() => {
    // è™•ç†å®Œæˆï¼Œé€šçŸ¥ä¸»åŸ·è¡Œç·’
    Atomics.store(statusArray, 0, 2);
    Atomics.notify(statusArray, 0, 1);
  });
};
```

ä¸éé€™å€‹åŠŸèƒ½åœ¨ä¸€èˆ¬å‰ç«¯é–‹ç™¼ä¸­ç”¨åˆ°çš„æ©Ÿæœƒä¸å¤šï¼Œæ¯”è¼ƒé©ç”¨æ–¼éœ€è¦é«˜æ•ˆèƒ½è¨ˆç®—çš„æƒ…æ³ï¼Œä¾‹å¦‚åœ–ç‰‡è™•ç†ã€éŸ³è¨Šè™•ç†ã€å¤§æ•¸æ“šé‹ç®—ç­‰ç­‰ã€‚

### Well-Formed Unicode Strings [æ”¯æ´åº¦](https://caniuse.com/mdn-javascript_builtins_string_iswellformed)

æ–°å¢äº† `String.prototype.isWellFormed()` å’Œ `String.prototype.toWellFormed()` æ–¹æ³•ï¼Œç”¨æ–¼æª¢æŸ¥å’Œç¢ºä¿å­—ä¸²åŒ…å«æœ‰æ•ˆçš„ Unicode åºåˆ—ã€‚

```javascript
const strings = [
  // æ­£å¸¸çš„å­—ä¸²
  "Hello",
  // åŒ…å«å­¤ç«‹çš„ high surrogate
  "ab\uD800",
  // åŒ…å«å­¤ç«‹çš„ low surrogate
  "\uDFFFab",
  // æ­£ç¢ºçš„ surrogate pair
  "ab\uD83D\uDE04c",
];

for (const str of strings) {
  console.log(str, str.isWellFormed());
}
// Hello true
// abï¿½ false
// ï¿½ab false
// abğŸ˜„c true

// ä¿®æ­£æ ¼å¼ä¸æ­£ç¢ºçš„å­—ä¸²
const malformed = "ab\uD800";
console.log(malformed.isWellFormed()); // false
console.log(malformed.toWellFormed()); // "abï¿½"
console.log(malformed.toWellFormed().isWellFormed()); // true
```

## é‡é»æ•´ç†

æˆ‘è¦ºå¾—æœ¬æ¬¡æ–°åŠŸèƒ½æ¯”è¼ƒæœƒç”¨åˆ°çš„æ˜¯ä»¥ä¸‹å…©å€‹ï¼š

- `Promise.withResolvers()`ï¼šå¯ä»¥åœ¨ Promise å¤–éƒ¨æ§åˆ¶ resolve/rejectã€‚
- `Object.groupBy()` / `Map.groupBy()`ï¼šå…§å»ºé™£åˆ—åˆ†çµ„åŠŸèƒ½ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿å°‡é™£åˆ—ä¾æ¢ä»¶åˆ†çµ„ã€‚

## åƒè€ƒè³‡æ–™

- [ECMAScript 2024 Language Specification](https://262.ecma-international.org/15.0/)
- [TC39 finished proposals](https://github.com/tc39/proposals/blob/main/finished-proposals.md)
