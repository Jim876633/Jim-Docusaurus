---
title: å¦‚ä½•è‡ªå‹•é¡¯ç¤º Docusaurus æ–‡ç« åˆ—è¡¨
sidebar_position: 4
tags: ["Docusaurus", "æ–‡ç« åˆ—è¡¨"]
---

import { Img } from "../../src/components/width";
import image_1 from "./img/getDocList-1.png";
import image_2 from "./img/getDocList-2.png";
import image_3 from "./img/getDocList-3.png";

é›–ç„¶ Docusaurus æœ‰ Sidebar å¯ä»¥å¾ˆæ¸…æ¥šåœ°æ‰¾åˆ°ä½ è¦çš„æ–‡ç« ï¼Œä½†æˆ‘å¸Œæœ›å¯ä»¥åœ¨é¦–é çœ‹åˆ°æœ€æ–°æ›´æ–°çš„æ–‡ç« åˆ—è¡¨ï¼Œä¸éåœ¨ Docusaurus æ²’æœ‰å…§å»ºçš„åŠŸèƒ½æˆ– API å¯ä»¥é¡¯ç¤ºæ‰€æœ‰çš„æ–‡ç« ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±åšä¸€å€‹è‡ªå‹•çˆ¬èŸ²çš„ componentã€‚

## æƒ³æ³•æ¦‚å¿µ

åœ¨æ‰¾æœ‰æ²’æœ‰å®˜æ–¹æä¾›çš„ API é”åˆ°æˆ‘è¦çš„åŠŸèƒ½æ™‚ï¼Œæœ‰çœ‹åˆ°ä¸€å€‹ `useDocsSidebar()` çš„å‡½å¼å¯ä»¥æŠ“å‡º sidebar çš„æ¸…å–®ï¼Œæ±ºå®šå¾é€™è£¡ä¸‹æ‰‹ã€‚å†åˆ©ç”¨è£¡é¢æä¾›çš„å„é é¢çš„ url å»æŠ“ç¶²é çš„ HTMLï¼Œç¯©é¸å‡ºæˆ‘è¦çš„è³‡æ–™ã€‚

æ­¥é©Ÿå¤§æ¦‚æ˜¯é€™æ¨£ï¼š

1. ç”¨ `useDocsSidebar()` æŠ“å‡ºæ‰€æœ‰é é¢çš„ url é™£åˆ—ã€‚
2. ç”¨ `Promise.all()` åŒæ™‚ fetch æ‰€æœ‰çš„éœæ…‹é é¢æ–‡å­—æª”ã€‚
3. ä½¿ç”¨åŸç”Ÿ `DOMParser()` è½‰æˆ HTML æ ¼å¼ï¼Œä¸¦æŠ“å–è³‡æ–™ã€‚
4. æœ€å¾ŒæŠŠ component å¼•å…¥ mdx æª”ã€‚

## Step1: useDocsSidebar()

å…ˆå»ºä¸€å€‹ component å« `DocList`ï¼Œä½¿ç”¨ `useDocsSidebar()` å–å‡ºè£¡é¢çš„ **items**ã€‚

```jsx title=DocList.jsx
import { useDocsSidebar } from "@docusaurus/theme-common/internal";

function DocList() {
  const { items } = useDocsSidebar();
  ...
}
```

å–å‡ºä¾†å¾Œæœƒé•·é€™æ¨£

<Img src={image_1} />

å°±æ˜¯ä½ çš„ Sidebar çš„è³‡æ–™çµæ§‹ï¼Œé€™é‚Šå¦‚æœæœ‰å¾ˆå¤šå±¤çš„è©±éœ€è¦ä¸€å±¤ä¸€å±¤æ‹†æ‰ï¼Œå¯ä»¥ç”¨ lodash çš„ flatMapDeep è§£æ§‹ã€‚æˆ–æ˜¯åƒæˆ‘ä¸€æ¨£ä¸æƒ³è£å¥—ä»¶ï¼Œç”¨ flatMap åŠ éè¿´çš„æ–¹å¼æ‹†é–‹ã€‚

```jsx
function formatDocList(items) {
  return items.flatMap((item) => {
    if (!item.items) {
      return {
        title: item.label,
        id: item.docId,
        href: item.href,
      };
    } else {
      return formatDocList(item.items);
    }
  });
}
```

## Step2: Promise.all()

æ•´ç†å®Œå¾Œï¼Œå†æŠ“å‡ºä¸€å€‹åªæœ‰ href çš„é™£åˆ—ï¼Œç„¶å¾Œå†ç”¨ `Promise.all()` åŒæ™‚ç™¼å‡ºè«‹æ±‚ã€‚

```jsx
async function fetchDocs(docsList) {
  const docUrlList = docsList.map(
    (doc) => `https://jim876633.github.io${doc.href}`
  );

  const results = await Promise.all(
    docUrlList.map((url) => fetch(url).then((res) => res.text()))
  );
}
```

å›å‚³çš„ `result` å°±æ˜¯å«æœ‰æ‰€æœ‰é é¢ HTML æ–‡å­—çš„é™£åˆ—ã€‚

## Step3: DOMParser();

å› ç‚ºæŠ“å›ä¾†çš„æ˜¯æ–‡å­—ï¼Œæ¯”è¼ƒé›£å»å–å¾—æƒ³è¦çš„è³‡è¨Šï¼Œæ‰€ä»¥é€™é‚Šç”¨åŸç”Ÿçš„ `DOMParser()` å»å°‡æ–‡å­—è½‰æˆ HTMLã€‚

```jsx
results.forEach((data, i) => {
  // translate to html
  const parser = new DOMParser();
  const html = parser.parseFromString(data, "text/html");
  const body = html.body;
});
```

æŠ“åˆ° body çš„ DOM å¾Œï¼Œå°±è¦ä¾†æŠ“æˆ‘è¦çš„*æ›´æ–°æ—¥æœŸ*ï¼Œé€™é‚Šè¦å…ˆåœ¨ `docusaurus.config.js` è¨­å®š **showLastUpdateTime**ï¼Œè©³ç´°è³‡è¨Šå¯ä»¥åƒè€ƒ[å®˜ç¶²](https://docusaurus.io/docs/api/plugins/@docusaurus/plugin-content-docs#showLastUpdateTime)ï¼Œé€™é‚Šå°±ä¸å¤šè´…è¿°ã€‚

æ”¾æ›´æ–°æ—¥æœŸçš„ HTML tag æ˜¯ä¸€å€‹ `<time>...<time/>` çš„çµæ§‹ï¼Œå®ƒæœ‰ä¸€å€‹ `datetime` çš„ Attributeï¼Œè£¡é¢æ”¾çš„å°±æ˜¯æˆ‘è¦çš„æ—¥æœŸæ ¼å¼ã€‚

<Img src={image_2} />

å†ä¾†çš„å°±åªæ˜¯æŠŠå®ƒå–å‡ºä¾†ï¼Œç„¶å¾Œåˆä½µåˆ°ä¹‹å‰æ•´ç†éçš„ç‰©ä»¶è£¡ã€‚

```jsx {8-16} showLineNumbers
const timeStamp = time.getAttribute("datetime");
docs[i].timeStamp = new Date(timeStamp).getTime();
```

## Step4: import component

æœ€å¾Œæ‹¿åˆ°æœ‰æ—¥æœŸçš„ç‰©ä»¶é™£åˆ—ï¼Œå†ç”¨ `sort` å»ä¾æ“šæ—¥æœŸæ’åºï¼Œç„¶å¾Œå† import åˆ° .mdx æª”ï¼ˆè¨˜å¾—æŠŠ .md è½‰æˆ .mdx æ‰èƒ½å¼•å…¥ï¼‰ã€‚

```jsx title='intro.mdx'
import DocList from "../src/components/docList.jsx";

<DocList />;
```

å°±å¯ä»¥åœ¨é¦–é çœ‹åˆ°æœ€æ–°æ›´æ–°çš„æ–‡ç« åˆ—è¡¨äº† ğŸ‰

<Img src={image_3} width='50%' />

## é¡å¤–è£œå……

ä¸éå› ç‚ºæ˜¯ç”¨ component å¼•å…¥ï¼Œæ‰€ä»¥åªè¦é€²å…¥åˆ°é¦–é å°±æœƒ fetch æ‰€æœ‰æ–‡ç« çš„è³‡æ–™ï¼Œé€™æ¨£æ•ˆèƒ½ä¸¦ä¸æ˜¯å¾ˆå¥½ï¼Œæƒ³å„ªåŒ–æ•ˆèƒ½çš„å¯ä»¥ä½¿ç”¨ [TanStack Query](https://tanstack.com/query/latest) ä¾†ç®¡ç† API è«‹æ±‚ï¼Œæœ‰èˆˆè¶£çš„å¯ä»¥çœ‹æˆ‘å®Œæ•´çš„ç¨‹å¼ç¢¼ã€‚
